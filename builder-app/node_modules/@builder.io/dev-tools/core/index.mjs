var An=Object.create;var ht=Object.defineProperty;var On=Object.getOwnPropertyDescriptor;var _n=Object.getOwnPropertyNames;var jn=Object.getPrototypeOf,Bn=Object.prototype.hasOwnProperty;var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Vn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _n(t))!Bn.call(e,o)&&o!==r&&ht(e,o,{get:()=>t[o],enumerable:!(n=On(t,o))||n.enumerable});return e};var $n=(e,t,r)=>(r=e!=null?An(jn(e)):{},Vn(t||!e||!e.__esModule?ht(r,"default",{value:e,enumerable:!0}):r,e));var rt=z(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});function on(e){return Object.prototype.toString.call(e)}Le.getType=on;function lo(e){throw new TypeError("unsupported data type: "+on(e))}Le.throwUnknownDataType=lo});var lt=z(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});var B="";for(let e=0;e<10;e++){let t=String.fromCharCode(48+e);B+=t}for(let e=0;e<26;e++){let t=String.fromCharCode(65+e);B+=t}for(let e=0;e<26;e++){let t=String.fromCharCode(97+e);B+=t}var se=B.length,it={};for(let e=0;e<se;e++){let t=B[e];it[t]=e}function at(e){let t=0,r=1;for(let n=e.length-1;n>=0;n--){let o=e[n],i=it[o];i*=r,t+=i,r*=se}return t}V.s_to_int=at;function an(e){let t=BigInt(0),r=BigInt(1),n=BigInt(se);for(let o=e.length-1;o>=0;o--){let i=e[o],a=BigInt(it[i]);a*=r,t+=a,r*=n}return t}V.s_to_big_int=an;function st(e){if(e===0)return B[0];let t=[];for(;e!==0;){let r=e%se,n=B[r];t.push(n),e-=r,e/=se}return t.reverse().join("")}V.int_to_s=st;function sn(e){let t=BigInt(0),r=BigInt(se);if(e===t)return B[0];let n=[];for(;e!==t;){let o=e%r,i=B[Number(o)];n.push(i),e-=o,e/=r}return n.reverse().join("")}V.big_int_to_s=sn;function Ae(e){return e.split("").reverse().join("")}function ln(e){if(e<0)return"-"+ln(-e);let[t,r]=e.toString().split(".");if(!r)return st(e);let n;r&&([r,n]=r.split("e")),t=ke(t),r=Ae(r),r=ke(r);let o=t+"."+r;if(n){switch(o+=".",n[0]){case"+":n=n.slice(1);break;case"-":o+="-",n=n.slice(1);break}n=Ae(n),n=ke(n),o+=n}return o}V.num_to_s=ln;function ke(e){let t=+e;return t.toString()===e?st(t):":"+sn(BigInt(e))}V.int_str_to_s=ke;function ot(e){return e[0]===":"?an(e.substring(1)).toString():at(e).toString()}function cn(e){if(e[0]==="-")return-cn(e.substr(1));let[t,r,n]=e.split(".");if(!r)return at(t);t=ot(t),r=ot(r),r=Ae(r);let o=t+"."+r;if(n){o+="e";let i=!1;n[0]==="-"&&(i=!0,n=n.slice(1)),n=ot(n),n=Ae(n),o+=i?-n:+n}return+o}V.s_to_num=cn});var pt=z($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});var ct=lt();function co(e){return"n|"+ct.num_to_s(e)}$.encodeNum=co;function po(e){return e=e.replace("n|",""),ct.s_to_num(e)}$.decodeNum=po;function uo(e){return typeof e=="number"?e:ct.s_to_int(e)}$.decodeKey=uo;function fo(e){return e?"b|T":"b|F"}$.encodeBool=fo;function mo(e){switch(e){case"b|T":return!0;case"b|F":return!1}return!!e}$.decodeBool=mo;function go(e){switch(e[0]+e[1]){case"b|":case"o|":case"n|":case"a|":case"s|":e="s|"+e}return e}$.encodeStr=go;function xo(e){return e[0]+e[1]==="s|"?e.substr(2):e}$.decodeStr=xo});var pn=z(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.config={sort_key:!1}});var mt=z(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});var So=pn(),ho=rt(),ft=pt(),Co=lt();function wo(e){return e.store.toArray()}ee.memToValues=wo;function un(){let e=[];return{forEach(t){for(let r=0;r<e.length;r++)if(t(e[r])==="break")return},add(t){e.push(t)},toArray(){return e}}}ee.makeInMemoryStore=un;function fn(){let e=Object.create(null),t=Object.create(null);return{getValue(r){return e[r]},getSchema(r){return t[r]},forEachValue(r){for(let[n,o]of Object.entries(e))if(r(n,o)==="break")return},forEachSchema(r){for(let[n,o]of Object.entries(t))if(r(n,o)==="break")return},setValue(r,n){e[r]=n},setSchema(r,n){t[r]=n},hasValue(r){return r in e},hasSchema(r){return r in t}}}ee.makeInMemoryCache=fn;function yo(){return{store:un(),cache:fn(),keyCount:0}}ee.makeInMemoryMemory=yo;function Z(e,t){if(e.cache.hasValue(t))return e.cache.getValue(t);let r=e.keyCount++,n=Co.num_to_s(r);return e.store.add(t),e.cache.setValue(t,n),n}function Eo(e,t){So.config.sort_key&&t.sort();let r=t.join(",");if(e.cache.hasSchema(r))return e.cache.getSchema(r);let n=xe(e,t,void 0);return e.cache.setSchema(r,n),n}function xe(e,t,r){if(t===null)return"";switch(typeof t){case"undefined":if(Array.isArray(r))return xe(e,null,r);break;case"object":if(t===null)return Z(e,null);if(Array.isArray(t)){let n="a";for(let o=0;o<t.length;o++){let i=t[o],a=i===null?"_":xe(e,i,t);n+="|"+a}return n==="a"&&(n="a|"),Z(e,n)}else{let n=Object.keys(t);if(n.length===0)return Z(e,"o|");let o="o",i=Eo(e,n);o+="|"+i;for(let a of n){let s=t[a],c=xe(e,s,t);o+="|"+c}return Z(e,o)}case"boolean":return Z(e,ft.encodeBool(t));case"number":return Z(e,ft.encodeNum(t));case"string":return Z(e,ft.encodeStr(t))}return ho.throwUnknownDataType(t)}ee.addValue=xe});var gt=z(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});var Do=rt(),Oe=pt(),dt=mt();function vo(e){let t=dt.makeInMemoryMemory(),r=dt.addValue(t,e,void 0);return[dt.memToValues(t),r]}he.compress=vo;function To(e,t){if(t==="o|")return{};let r={},n=t.split("|"),o=n[1],i=Se(e,o),a=n.length;a-2===1&&!Array.isArray(i)&&(i=[i]);for(let s=2;s<a;s++){let c=i[s-2],u=n[s];u=Se(e,u),r[c]=u}return r}function bo(e,t){if(t==="a|")return[];let r=t.split("|"),n=r.length-1,o=new Array(n);for(let i=0;i<n;i++){let a=r[i+1];a=Se(e,a),o[i]=a}return o}function Se(e,t){if(t===""||t==="_")return null;let r=Oe.decodeKey(t),n=e[r];if(n===null)return n;switch(typeof n){case"undefined":return n;case"number":return n;case"string":switch(n[0]+n[1]){case"b|":return Oe.decodeBool(n);case"o|":return To(e,n);case"n|":return Oe.decodeNum(n);case"a|":return bo(e,n);default:return Oe.decodeStr(n)}}return Do.throwUnknownDataType(n)}he.decode=Se;function Po(e){let[t,r]=e;return Se(t,r)}he.decompress=Po});var dn=z(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});function Io(e){for(let t in e)e[t]===void 0&&delete e[t]}_e.trimUndefined=Io;function No(e){mn(e,new Set)}_e.trimUndefinedRecursively=No;function mn(e,t){t.add(e);for(let r in e)if(e[r]===void 0)delete e[r];else{let n=e[r];n&&typeof n=="object"&&!t.has(n)&&mn(n,t)}}});var Sn=z(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});var gn=gt();W.compress=gn.compress;W.decompress=gn.decompress;var Ro=gt();W.decode=Ro.decode;var Fo=mt();W.addValue=Fo.addValue;var xn=dn();W.trimUndefined=xn.trimUndefined;W.trimUndefinedRecursively=xn.trimUndefinedRecursively});async function Ct(e,t){let r=e.resolve("/");for(let n=0;n<20;n++){let o=e.join(t,"package.json"),i=await e.readFile(o);if(i)return JSON.parse(i);if(t===r)break;t=e.dirname(t)}return null}async function wt(e,t){for(let r=0;r<20;r++){let n=e.dirname(t),o=e.join(n,"node_modules");if(await e.exists(o))return o;if(t===e.getRootDir())break;t=e.dirname(t)}return e.join(e.getRootDir(),"node_modules")}async function le(e,t,r){let n=await e.readdir(t);return n.includes(r)?e.join(t,r):(await Promise.all(n.map(async i=>{if(i.startsWith(".")||i==="node_modules")return;let a=e.join(t,i);if((await e.stat(a)).isDirectory()){let c=await le(e,a,r);if(c)return c}}))).find(i=>typeof i=="string")}async function ce(e){let t=[],r=await Ct(e,e.getRootDir());if(r){let n=yt(r);t.push(...n)}return t}function yt(e){let t=[];if(e&&typeof e=="object"){let r=new Set(Object.keys({...e.dependencies,...e.devDependencies}));for(let n of zn)r.has(n)&&(t.some(o=>o.name===n)||t.push({name:n}))}return t}var zn=["@builder.io/qwik-city","@remix-run/react","@sveltejs/kit","astro","gatsby","next","nuxt","@builder.io/qwik","angular","react","solid-js","svelte","vue"];async function te(e,t,r){let n={envKey:r,envValue:null,file:""};for(let o of t){let i=e.join(e.getRootDir(),o),a=await Un(e,i);if(a){let s=a[r];if(typeof s=="string"&&s.length>0&&s!=="YOUR_API_KEY")return n.envValue=s,n.file=i,n}}return n.file=e.join(e.getRootDir(),t[t.length-1]),n}async function Un(e,t){let r=await e.readFile(t);return typeof r=="string"?Et(r):null}function Et(e){let t={},r=e.replace(/\r\n?/gm,`
`),n;for(;(n=Mn.exec(r))!=null;){let o=n[1],i=n[2]||"";i=i.trim();let a=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),a==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),t[o]=i}return t}var Mn=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;async function ne(e,t,r,n){let o="# https://www.builder.io/c/docs/using-your-api-key",i=await e.readFile(t);if(i)if(i.includes(r))if(i.includes(n))e.debug(`"${r}" with "${n}" already set in ${t}`);else return e.debug(`Replace "${r}" in ${t}`),i=i.replace(new RegExp(`${r}=.*`),`${r}=${n}`),await e.writeFile(t,i),"update";else return e.debug(`Append "${r}" to ${t}`),i+=`

${o}
${r}=${n}

`,await e.writeFile(t,i),"update";else return e.debug(`Creating new .env file with "${r}" at ${t}`),i=[o,`${r}=${n}`,""].join(`
`),await e.writeFile(t,i),"create";return null}async function Ve(e){return await te(e,[".env.local",".env.development.local",".env.production.local",".env.development",".env.production",".env"],pe)}async function Dt(e,t){let r=await Ve(e),n=await ne(e,r.file,r.envKey,t);return{...r,modifiedType:n}}var pe="NEXT_PUBLIC_BUILDER_API_KEY";function E(e,t=""){return e.ts.createSourceFile("module.tsx",typeof t=="string"?t:"",e.ts.ScriptTarget.Latest)}function vt(e,t=""){let r=E(e,t?.trim());if(r.statements.length===0)throw new Error(`No statements found in code: ${t}`);return r.statements[0]}function P(e,t,r){if(t){let n=e.ts.createPrinter({newLine:e.ts.NewLineKind.LineFeed,removeComments:r});return e.ts.isSourceFile(t)?n.printFile(t).trim()+`
`:n.printNode(e.ts.EmitHint.Unspecified,t,e.ts.createSourceFile("module.tsx","",e.ts.ScriptTarget.Latest)).trim()+`
`}return""}function R(e,t,r){t=U(t),r=U(r),t=e.dirname(t);let n=e.basename(r,e.extname(r));r=e.dirname(r);let o;return n==="index"?o=e.relative(t,r):o=e.relative(t,e.join(r,n)),o=U(e.normalize(o)),o.startsWith(".")||(o="./"+o),o}function U(e){return e.startsWith("\\\\?\\")?e:e.replace(/\\/g,"/")}function ue(e,t){let r=e.extname(t),n=e.basename(t,r);return Tt(n==="index"?e.basename(e.dirname(t)):n)}function Tt(e){return F(e).replace(/ /g,"")}function M(e,t){let r=e.extname(t),n=U(e.basename(t,r)).split("/").pop();return F(n==="index"?e.basename(e.dirname(t)):n)}function b(e,t){let r=t,n=[];for(let o=0;o<2;o++){let i=e.basename(r);if(!i||i==="components")break;n.unshift(i),r=e.dirname(r)}return n.join("/")}function F(e){for(e=e.replace(/([A-Z])/g," $1").replace(/\./g," ").replace(/_/g," ").replace(/-/g," ").replace(/\s/g," ").trim();e.includes("  ");)e=e.replace(/  /g," ");return e.split(" ").map(t=>t.length>2?t[0].toUpperCase()+t.slice(1):t).join("").trim()}function K(e){return e.sort((t,r)=>t.name.toLocaleLowerCase().localeCompare(r.name.toLocaleLowerCase()))}async function L(e,t,r){if(typeof r!="string"||r==="")throw new Error(`getComponentId(), exportName must be a non-empty string, received: ${r}, ${t}`);return t=e.normalize(t),(await e.hash(t+"#"+r)).substring(0,8)}function Ce(e){return typeof e=="number"}function fe(e){return typeof e=="boolean"}function A(e){return typeof e=="string"}function $e(e){return typeof e=="string"?/^[A-Z][A-Za-z0-9]*$/.test(e):!1}function k(e){return JSON.parse(JSON.stringify(e))}function de(e,t,r,n,o=!0){let i=t.properties.filter(s=>e.ts.isPropertyAssignment(s)),a=Kn(e,t,r);return a>-1?n==null&&o?e.ts.factory.updateObjectLiteralExpression(t,i.filter((s,c)=>c!==a)):(i[a]=e.ts.factory.updatePropertyAssignment(i[a],i[a].name,me(e,n)),e.ts.factory.updateObjectLiteralExpression(t,i)):(n!=null&&i.push(e.ts.factory.createPropertyAssignment(r,me(e,n))),e.ts.factory.updateObjectLiteralExpression(t,i))}function Kn(e,t,r){return t.properties.findIndex(n=>D(e,n)===r)}function we(e,t){switch(t.kind){case e.ts.SyntaxKind.ArrayLiteralExpression:return qn(e,t);case e.ts.SyntaxKind.ObjectLiteralExpression:return Qn(e,t);case e.ts.SyntaxKind.StringLiteral:return t.text;case e.ts.SyntaxKind.NumericLiteral:return Number(t.text);case e.ts.SyntaxKind.NoSubstitutionTemplateLiteral:return t.text;case e.ts.SyntaxKind.TrueKeyword:return!0;case e.ts.SyntaxKind.FalseKeyword:return!1;case e.ts.SyntaxKind.Identifier:switch(t.escapedText){case"undefined":return;case"null":return null;case"String":return String;case"Number":return Number;case"Boolean":return Boolean;case"NaN":return NaN}}}function Qn(e,t){let r={};if(t&&e.ts.isObjectLiteralExpression(t)){for(let n of t.properties)if(e.ts.isPropertyAssignment(n)){let o=D(e,n);o&&(r[o]=we(e,n.initializer))}}return r}function qn(e,t){return t&&e.ts.isArrayLiteralExpression(t)?t.elements.map(r=>we(e,r)):[]}function D(e,t){if(t&&e.ts.isPropertyAssignment(t)){let r=t.name;switch(r.kind){case e.ts.SyntaxKind.Identifier:return r.text;case e.ts.SyntaxKind.StringLiteral:case e.ts.SyntaxKind.NumericLiteral:return r.text;case e.ts.SyntaxKind.ComputedPropertyName:let n=r.expression;if(e.ts.isStringLiteral(n)||e.ts.isNumericLiteral(n))return r.expression.text}}}function me(e,t){return ze(e,t,new WeakSet)}function ze(e,t,r){return t===void 0?e.ts.factory.createIdentifier("undefined"):t===null?e.ts.factory.createIdentifier("null"):typeof t=="string"?e.ts.factory.createStringLiteral(t):typeof t=="number"?isNaN(t)?e.ts.factory.createIdentifier("NaN"):e.ts.factory.createNumericLiteral(t):t===!0?e.ts.factory.createTrue():t===!1?e.ts.factory.createFalse():t===String?e.ts.factory.createIdentifier("String"):t===Number?e.ts.factory.createIdentifier("Number"):t===Boolean?e.ts.factory.createIdentifier("Boolean"):Array.isArray(t)?Jn(e,t,r):typeof t=="object"?Wn(e,t,r):e.ts.factory.createIdentifier(t)}function Jn(e,t,r){let n=t.map(o=>ze(e,o,r));return e.ts.factory.createArrayLiteralExpression(n,!0)}function Wn(e,t,r){if(r.has(t))return e.ts.factory.createIdentifier("undefined");r.add(t);let n=Object.keys(t).map(o=>e.ts.factory.createPropertyAssignment(o,ze(e,t[o],r)));return e.ts.factory.createObjectLiteralExpression(n,!0)}function ye(e,t,r){let n=[],o=t.getTypeAtLocation(r),i;o.aliasTypeArguments&&o.aliasTypeArguments.length>0?i=o.aliasTypeArguments[0].getProperties():i=o.getProperties();for(let a of i){let s=Yn(e,t,a);s&&n.push(s)}return n}function Yn(e,t,r){let n=r.valueDeclaration;if(n&&e.ts.isPropertySignature(n)){let o=r.getName(),i=Hn(t,n),a={name:o,type:i,isRegistered:!1};return n.questionToken||(a.required=!0),a}return null}function Hn(e,t){if(t?.type){let r=e.getTypeFromTypeNode(t.type),n=e.typeToString(r);return Ue(n)}return"string"}function Ue(e){return typeof e=="string"&&(e=e.trim(),Gn.some(t=>t.value===e))?e:"string"}var Gn=[{value:"boolean",text:"boolean"},{value:"color",text:"color (provides a color in hex or rgb)"},{value:"date",text:"date (same format as the Date constructor)"},{value:"email",text:"email"},{value:"file",text:"file (uploads a file and provides a url)"},{value:"list",text:"list (collection of items)"},{value:"longText",text:"longText (multiline text editor)"},{value:"number",text:"number"},{value:"object",text:"object (set of specific names and values)"},{value:"richText",text:"richText (provides value as html)"},{value:"string",text:"string"}];function Y(e,t,r){for(let n of r.properties){if(!e.ts.isPropertyAssignment(n))continue;let o=D(e,n);if(o==="name"&&e.ts.isStringLiteral(n.initializer)){t.name=n.initializer.text;continue}if(o==="description"&&e.ts.isStringLiteral(n.initializer)){t.description=n.initializer.text;continue}if(o==="image"&&e.ts.isStringLiteral(n.initializer)){t.image=n.initializer.text;continue}if(o==="inputs"&&e.ts.isArrayLiteralExpression(n.initializer)){let i=Xn(e,n.initializer);H(t,i);continue}}return t}function Xn(e,t){let r=[];for(let n of t.elements)e.ts.isObjectLiteralExpression(n)&&r.push(Zn(e,n));return r}function Zn(e,t){let r=we(e,t);return r=or(r),r.isRegistered=!0,r}function Q(e,t,r){return t=de(e,t,"name",r.name,!1),t=de(e,t,"description",r.description),t=de(e,t,"image",r.image),t=er(e,t,r),ir(e,t)}function er(e,t,r){let n=null,o=r.inputs.filter(s=>s.isRegistered),i=t.properties.filter(s=>e.ts.isPropertyAssignment(s)&&e.ts.isIdentifier(s.name)),a=i.findIndex(s=>e.ts.isIdentifier(s.name)&&s.name.text==="inputs");if(a>-1){if(o.length===0)return de(e,t,"inputs",null);let s=i[a];e.ts.isPropertyAssignment(s)&&e.ts.isArrayLiteralExpression(s.initializer)&&(n=s.initializer)}return o.length===0?t:(n=tr(e,n||e.ts.factory.createArrayLiteralExpression(),o),a>-1?i[a]=e.ts.factory.updatePropertyAssignment(i[a],i[a].name,n):i.push(e.ts.factory.createPropertyAssignment("inputs",n)),e.ts.factory.updateObjectLiteralExpression(t,i))}function tr(e,t,r){let n=t.elements.filter(o=>{if(!e.ts.isObjectLiteralExpression(o))return!1;let i=o.properties.find(s=>D(e,s)==="name");if(!i)return!1;let a=i.initializer;return e.ts.isStringLiteral(a)?r.some(s=>s.name===a.text):!1});for(let o of r)n=nr(e,n,o);return n.sort((o,i)=>{let a=o.properties.find(p=>D(e,p)==="name"),s=i.properties.find(p=>D(e,p)==="name"),c=a?.initializer,u=s?.initializer,d=c&&e.ts.isStringLiteral(c)?c.text:"zz",f=u&&e.ts.isStringLiteral(u)?u.text:"zz";return d.toLowerCase().localeCompare(f.toLowerCase())}),e.ts.factory.updateArrayLiteralExpression(t,n)}function nr(e,t,r){let n=t.findIndex(o=>o.properties.some(i=>{let a=D(e,i);return e.ts.isPropertyAssignment(i)&&a==="name"&&e.ts.isStringLiteral(i.initializer)&&i.initializer.text===r.name}));if(n>-1)t[n]=bt(e,t[n],r);else{let o=bt(e,e.ts.factory.createObjectLiteralExpression([e.ts.factory.createPropertyAssignment("name",e.ts.factory.createStringLiteral(r.name))],!0),r);t.push(o)}return t}function bt(e,t,r){let n=t.properties.filter(i=>e.ts.isPropertyAssignment(i)),o=Object.keys(r).filter(i=>i!=="isRegistered");for(let i of o)n=rr(e,n,r,i);return n=ar(e,n.filter(i=>{let a=D(e,i);return o.includes(a)})),e.ts.factory.updateObjectLiteralExpression(t,n)}function rr(e,t,r,n){let o=t.findIndex(i=>e.ts.isIdentifier(i.name)&&i.name.text===n);return o>-1?t[o]=e.ts.factory.updatePropertyAssignment(t[o],t[o].name,me(e,r[n])):t.push(e.ts.factory.createPropertyAssignment(n,me(e,r[n]))),t}function H(e,t){for(let r of t){let n=e.inputs.findIndex(o=>o.name===r.name);n>-1?(r.isRegistered||!e.inputs[n].isRegistered)&&(e.inputs[n]=r):e.inputs.push(r)}}function or(e){let t={name:e.name.trim(),type:Ue(e.type)};return A(e.friendlyName)&&e.friendlyName.trim()!==e.name.trim()&&(t.friendlyName=e.friendlyName),(A(e.defaultValue)||Ce(e.defaultValue)||fe(e.defaultValue))&&(t.defaultValue=e.defaultValue),A(e.helperText)&&(t.helperText=e.helperText),fe(e.required)&&(t.required=e.required),t}function ir(e,t){let r=[...t.properties].sort((n,o)=>{let i=D(e,n)||"zz",a=D(e,o)||"zz";if(i==="inputs")return 1;let s=Pt.indexOf(i),c=Pt.indexOf(a);return s>-1?c>-1&&s>c?1:-1:c>-1?s>-1&&c<s?-1:1:i.localeCompare(a)});return e.ts.factory.updateObjectLiteralExpression(t,r)}var Pt=["component","name","description"];function ar(e,t){return[...t].sort((n,o)=>{let i=D(e,n)||"zz",a=D(e,o)||"zz",s=It.indexOf(i),c=It.indexOf(a);return s>-1?c>-1&&s>c?1:-1:c>-1?s>-1&&c<s?-1:1:i.localeCompare(a)})}var It=["name","type"];function Nt(e,t){let r=`Builder.registerComponent(
`;if(e.appDir)r+=`  ${t.importName},
`;else{let o=R(e,e.registryPath,t.filePath);t.exportName==="default"?r+=`  dynamic(() => import(${JSON.stringify(o)})),
`:r+=`  dynamic(async () => (await import(${JSON.stringify(o)})).${t.exportName}),
`}r+=`  {
    name: "${t.name}",
  }
`,r+=");";let n=vt(e,r);return Me(e,n,t)}function Me(e,t,r){if(!e.ts.isExpressionStatement(t))return t;let n=t.expression;if(!e.ts.isCallExpression(n))return t;let o=[...n.arguments];if(o.length<2)return t;let i=o[1];return e.ts.isObjectLiteralExpression(i)?(o[1]=Q(e,i,r),e.ts.factory.updateExpressionStatement(t,e.ts.factory.updateCallExpression(n,n.expression,n.typeArguments,o))):t}function I(e,t,r,n="esm"){return Array.isArray(r.namedImports)&&r.namedImports.forEach(o=>{t=sr(e,t,o,r.importPath,!!r.isTypeOnly,n)}),typeof r.defaultImport=="string"&&(t=lr(e,t,r.defaultImport,r.importPath,n)),t}function sr(e,t,r,n,o,i){return i==="cjs"?Ft(e,t,null,r,n):Rt(e,t,null,r,n,o)}function lr(e,t,r,n,o){return o==="cjs"?Ft(e,t,r,null,n):Rt(e,t,r,null,n,!1)}function Rt(e,t,r,n,o,i){let a=[...t.statements],s=0,c=!1,u=!1;for(let l=0;l<a.length;l++){let m=a[l];if(!e.ts.isImportDeclaration(m)||(s=l,!m.moduleSpecifier||!e.ts.isStringLiteral(m.moduleSpecifier))||m.moduleSpecifier.text!==o||i&&m.importClause?.isTypeOnly!==i)continue;let x=[],S=m.importClause?.namedBindings;if(S&&e.ts.isNamedImports(S)&&S.elements&&x.push(...S.elements),typeof n=="string"){if(x.some(h=>h.name.text===n))return t;x.push(e.ts.factory.createImportSpecifier(!1,void 0,e.ts.factory.createIdentifier(n))),x.sort((h,C)=>h.name.text.localeCompare(C.name.text)),c=!0}let g=m.importClause?m.importClause.name:void 0;if(typeof r=="string"){if(g&&g.text===r)return t;g=e.ts.factory.createIdentifier(r),u=!0}if(c||u)return a[l]=e.ts.factory.updateImportDeclaration(m,void 0,e.ts.factory.createImportClause(i,g,e.ts.factory.createNamedImports(x)),m.moduleSpecifier,void 0),e.ts.factory.updateSourceFile(t,a)}let d,f;typeof r=="string"&&(d=e.ts.factory.createIdentifier(r)),typeof n=="string"&&(f=e.ts.factory.createNamedImports([e.ts.factory.createImportSpecifier(!1,void 0,e.ts.factory.createIdentifier(n))]));let p=e.ts.factory.createImportDeclaration(void 0,e.ts.factory.createImportClause(i,d,f),e.ts.factory.createStringLiteral(o));return a.splice(s,0,p),e.ts.factory.updateSourceFile(t,a)}function Ft(e,t,r,n,o){let i=[...t.statements],a=0;for(let s=0;s<i.length;s++){let c=i[s];if(e.ts.isVariableStatement(c))for(let u=0;u<c.declarationList.declarations.length;u++){let d=[...c.declarationList.declarations],f=d[u],p=f.initializer;if(!p||!e.ts.isCallExpression(p))continue;let l=p.expression;if(!e.ts.isIdentifier(l)||l.text!=="require"||p.arguments.length!==1)continue;let m=p.arguments[0];if(e.ts.isStringLiteral(m)&&(a=s,m.text===o)){if(e.ts.isIdentifier(f.name)&&typeof r=="string")return f.name.text===r?t:(d[u]=e.ts.factory.updateVariableDeclaration(f,e.ts.factory.createIdentifier(r),f.exclamationToken,f.type,f.initializer),i[s]=e.ts.factory.updateVariableStatement(c,c.modifiers,e.ts.factory.updateVariableDeclarationList(c.declarationList,d)),e.ts.factory.updateSourceFile(t,i));if(e.ts.isObjectBindingPattern(f.name)&&typeof n=="string"){let x=[...f.name.elements];return x.some(g=>!e.ts.isBindingElement(g)||!e.ts.isIdentifier(g.name)?!1:g.name.text===n)?t:(x.push(e.ts.factory.createBindingElement(void 0,void 0,n)),x.sort((g,h)=>!e.ts.isBindingElement(g)||!e.ts.isIdentifier(g.name)||!e.ts.isBindingElement(h)||!e.ts.isIdentifier(h.name)?0:g.name.text.localeCompare(h.name.text)),d[u]=e.ts.factory.updateVariableDeclaration(f,e.ts.factory.createObjectBindingPattern(x),f.exclamationToken,f.type,f.initializer),i[s]=e.ts.factory.updateVariableStatement(c,c.modifiers,e.ts.factory.updateVariableDeclarationList(c.declarationList,d)),e.ts.factory.updateSourceFile(t,i))}}}}if(typeof r=="string"){let s=e.ts.factory.createVariableStatement(void 0,e.ts.factory.createVariableDeclarationList([e.ts.factory.createVariableDeclaration(r,void 0,void 0,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier("require"),void 0,[e.ts.factory.createStringLiteral(o)]))],e.ts.NodeFlags.Const));return i.splice(a,0,s),e.ts.factory.updateSourceFile(t,i)}if(typeof n=="string"){let s=e.ts.factory.createVariableStatement(void 0,e.ts.factory.createVariableDeclarationList([e.ts.factory.createVariableDeclaration(e.ts.factory.createObjectBindingPattern([e.ts.factory.createBindingElement(void 0,void 0,n)]),void 0,void 0,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier("require"),void 0,[e.ts.factory.createStringLiteral(o)]))],e.ts.NodeFlags.Const));return i.splice(a,0,s),e.ts.factory.updateSourceFile(t,i)}return t}function O(e,t,r="esm"){return r==="cjs"?pr(e,t):cr(e,t)}function cr(e,t){let r=[];for(let n of t.statements){if(e.ts.isExportDeclaration(n)){if(n.exportClause&&e.ts.isNamedExports(n.exportClause)){for(let o of n.exportClause.elements)if(e.ts.isIdentifier(o.name)){let i=o.name.text;for(let a of t.statements)if(e.ts.isVariableStatement(a))for(let s of a.declarationList.declarations)e.ts.isIdentifier(s.name)&&s.name.text===i&&r.push({isDefaultExport:!1,statement:a,node:a});else e.ts.isFunctionDeclaration(a)&&a.name&&a.name.text===i&&r.push({isDefaultExport:!1,statement:a,node:a})}}continue}if(e.ts.isExportAssignment(n)){let o=n.flags===e.ts.NodeFlags.None,i=n.expression;if(e.ts.isIdentifier(i)){let a=i.text;for(let s of t.statements){if(e.ts.isVariableStatement(s))for(let c of s.declarationList.declarations)e.ts.isIdentifier(c.name)&&c.name.text===a&&r.push({isDefaultExport:o,statement:s,node:s});e.ts.isFunctionDeclaration(s)&&s.name?.text===a&&r.push({isDefaultExport:o,statement:s,node:s})}}else(e.ts.isArrowFunction(i)||e.ts.isCallExpression(i)||e.ts.isFunctionDeclaration(i)||e.ts.isObjectLiteralExpression(i))&&r.push({isDefaultExport:o,statement:n,node:i});continue}if((e.ts.isVariableStatement(n)||e.ts.isFunctionDeclaration(n))&&n.modifiers&&n.modifiers.some(o=>o.kind===e.ts.SyntaxKind.ExportKeyword)){r.push({isDefaultExport:n.modifiers.some(o=>o.kind===e.ts.SyntaxKind.DefaultKeyword),statement:n,node:n});continue}}return r}function pr(e,t){let r=[];for(let n of t.statements)if(e.ts.isExpressionStatement(n)&&e.ts.isBinaryExpression(n.expression)&&e.ts.isPropertyAccessExpression(n.expression.left)){let o=n.expression.left,i=n.expression.right;if(!e.ts.isIdentifier(o.expression))continue;if(o.expression.text==="module"&&o.name.text==="exports"){if(e.ts.isIdentifier(i)){let a=i.text;for(let s of t.statements)if(e.ts.isVariableStatement(s))for(let c of s.declarationList.declarations)e.ts.isIdentifier(c.name)&&c.name.text===a&&r.push({isDefaultExport:!0,statement:s,node:s});else e.ts.isFunctionDeclaration(s)&&s.name&&s.name.text===a&&r.push({isDefaultExport:!0,statement:s,node:s})}else r.push({isDefaultExport:!0,statement:n,node:i});continue}}return r}function ur(e,t,r){for(let n of t.statements)if(e.ts.isImportDeclaration(n)&&n.importClause){if(n.importClause.namedBindings&&e.ts.isNamedImports(n.importClause.namedBindings)){for(let o of n.importClause.namedBindings.elements)if(e.ts.isIdentifier(o.name)&&o.name.text===r&&e.ts.isStringLiteral(n.moduleSpecifier))return{importPath:n.moduleSpecifier.text,exportType:"named"}}if(n.importClause.name&&n.importClause.name.text===r&&e.ts.isStringLiteral(n.moduleSpecifier))return{importPath:n.moduleSpecifier.text,exportType:"default"}}return null}async function Ee(e,t,r,n){let o=ur(e,r,n);if(o){let i=await qe(e,e.normalize(e.resolve(e.dirname(t),o.importPath)));return{displayFilePath:b(e,i),filePath:i,importPath:o.importPath,exportType:o.exportType}}return null}function Qe(e,t,r){for(let n=0;n<t.statements.length;n++){let o=t.statements[n];if(e.ts.isVariableStatement(o)){for(let i of o.declarationList.declarations)if(e.ts.isIdentifier(i.name)&&i.name.text===r)return{statement:o,statementIndex:n}}}return null}function q(e,t,r){let n=Qe(e,t,r);if(n&&n.statement.declarationList.declarations.length>0){let o=n.statement.declarationList.declarations[0];if(o.initializer&&e.ts.isArrayLiteralExpression(o.initializer))return{statement:n.statement,statementIndex:n.statementIndex,variableDeclaration:o,arrayLiteralExp:o.initializer}}return null}function De(e,t){if(t){if(fr(e,t))return!0;let r=!1;if(t.forEachChild(n=>{De(e,n)&&(r=!0)}),r)return!0}return!1}function fr(e,t){return e.ts.isJsxElement(t)||e.ts.isJsxOpeningElement(t)||e.ts.isJsxOpeningFragment(t)||e.ts.isJsxSelfClosingElement(t)||e.ts.isJsxFragment(t)||e.ts.isJsxChild(t)}async function qe(e,t){let r=e.extname(t).toLowerCase();if(r===""||!Ke.includes(r)){for(let n of Ke){let o=t+n;if(await e.exists(o))return o}for(let n of Ke){let o=e.join(t,"index"+n);if(await e.exists(o))return o}}return t}var Ke=[".tsx",".jsx",".ts",".js"];async function mr(e,t){let r=await wt(e,t),n=e.join(r,"typescript","lib"),o=new Map,i={fileExists:a=>{if(a=e.normalize(a),a.includes("node_modules")){let s=ge.get(a);if(!s){try{e.statSync(a).isFile()?s={exists:!0,content:e.readFileSync(a)}:s={exists:!1}}catch{s={exists:!1}}ge.set(a,s)}return s.exists}return o.has(a)||o.set(a,e.existsSync(a)),o.get(a)},getCanonicalFileName:a=>e.normalize(a),getCurrentDirectory:()=>e.cwd(),getDefaultLibFileName:()=>e.join(n,"lib.d.ts"),getDefaultLibLocation:()=>n,getNewLine:()=>`
`,getSourceFile:a=>{if(a=e.normalize(a),a.includes("node_modules")){let c=ge.get(a);if(c)return E(e,c.content)}let s=e.readFileSync(a);if(s==null){let c=e.basename(a),u=e.extname(c).toLowerCase();if(a.startsWith(n)&&u===".ts"&&(s=kt.get(c),s==null&&typeof self<"u"&&typeof fetch=="function"))throw new Te(c)}return a.includes("node_modules")&&(s?ge.set(a,{exists:!0,content:s}):ge.set(a,{exists:!1})),E(e,s)},readFile:a=>{let s=e.readFileSync(a);return typeof s=="string"?s:void 0},useCaseSensitiveFileNames:()=>!1,writeFile:()=>{}};for(;;)try{return dr(e,i,t)}catch(a){if(a instanceof Te){await gr(e,a.libName);continue}return console.error(a),null}}function dr(e,t,r){let n={rootNames:[r],options:{},host:t},o=e.ts.findConfigFile(e.dirname(r),i=>e.existsSync(i));if(o){let i=Lt.get(o);if(!i){let a=e.ts.readConfigFile(o,s=>{let c=e.readFileSync(s);return typeof c=="string"?c:void 0});a.error?console.error("error reading tsconfig for createTsProgram"):(i=e.ts.parseJsonConfigFileContent(a.config,e.ts.sys||{useCaseSensitiveFileNames:!1,readDirectory:(c,u)=>e.readdirSync(c),fileExists:c=>e.existsSync(c),readFile:c=>e.readFileSync(c)||void 0},e.dirname(o),void 0,o).options,Lt.set(o,i))}i&&(n.options=k(i))}return n.options.moduleResolution=e.ts.ModuleResolutionKind.Node16,n.options.noEmit=!0,n.options.isolatedModules=!1,n.options.strict=!1,n.options.jsx=e.ts.JsxEmit.Preserve,n.options.allowJs=!0,e.ts.createProgram(n)}async function be(e,t){let r=await mr(e,t);if(!r)throw new Error(`getTypeChecker() Could not create program for: ${t}`);let n=r.getSourceFile(t);if(!n)throw new Error(`getTypeChecker() Could not find source file: ${t}`);return{typeChecker:r.getTypeChecker(),sourceFile:n}}var Te=class{constructor(t){this.libName=t}};async function gr(e,t){let r=`https://cdn.jsdelivr.net/npm/typescript@${e.ts.version}/lib/${t}`;ve.has(t)||ve.set(t,fetch(r).then(n=>n.text()).then(n=>{kt.set(t,n)})),await ve.get(t),ve.delete(t)}var kt=new Map,ve=new Map,ge=new Map,Lt=new Map;async function Ie(e,t){if(t.node.fnParams.length>0){let{sourceFile:r,typeChecker:n}=await be(e,t.cmpInfo.filePath),i=(await At(e,t.cmpInfo.filePath,r)).find(a=>a.cmpInfo.id===t.cmpInfo.id);if(!i)throw new Error(`createComponentInputs() Could not find component ${t.cmpInfo.name} in ${t.cmpInfo.filePath}`);return ye(e,n,i.node.fnParams[0])}return[]}async function re(e,t){let r=e.extname(t).toLowerCase();if(r===".tsx"||r===".jsx"||r===".ts"||r===".js"){let n=await e.readFile(t);if(n)return xr(e,t,n)}return null}function xr(e,t,r){let n=E(e,r);return At(e,t,n)}async function At(e,t,r){let n=[];for(let i of r.statements)if(e.ts.isExpressionStatement(i)&&e.ts.isStringLiteral(i.expression)&&i.expression.text==="use server")return n;let o=O(e,r);return t=e.normalize(t),await Promise.all(o.map(async i=>{let a=await Sr(e,t,i);n.push(...a)})),n}async function Sr(e,t,r){let n=[];if(e.ts.isVariableStatement(r.node)){for(let o of r.node.declarationList.declarations){if(!e.ts.isIdentifier(o.name)||!$e(o.name.text))continue;let i=Pe(e,o.initializer);if(i){let a=i.fnName||o.name.text,s=r.isDefaultExport?"default":a,c=r.isDefaultExport?"default":"named";n.push({cmpInfo:{id:await L(e,t,s),displayFilePath:b(e,t),name:F(a),inputs:[],exportName:s,exportType:c,importName:a,filePath:t},node:i})}}return n}if(e.ts.isArrowFunction(r.node)){let o=Pe(e,r.node);if(o){let i=M(e,t),a=r.isDefaultExport?"default":i,s=r.isDefaultExport?"default":"named";n.push({cmpInfo:{id:await L(e,t,a),displayFilePath:b(e,t),name:i,inputs:[],exportName:a,exportType:s,importName:ue(e,t),filePath:t},node:o})}return n}if(e.ts.isFunctionExpression(r.node)||e.ts.isFunctionDeclaration(r.node)){let o=r.node.name?.text;if(o&&!$e(o))return n;let i=Pe(e,r.node);if(i){let a=i.fnName||M(e,t),s=r.isDefaultExport||!i.fnName?"default":i.fnName,c=r.isDefaultExport?"default":"named";n.push({cmpInfo:{id:await L(e,t,s),displayFilePath:b(e,t),name:a,inputs:[],exportName:s,exportType:c,importName:ue(e,t),filePath:t},node:i})}return n}return n}function Pe(e,t){if(!t)return null;if(e.ts.isArrowFunction(t))return De(e,t.body)?{fnName:"",fnParams:t.parameters}:null;if(e.ts.isFunctionExpression(t)||e.ts.isFunctionDeclaration(t))return De(e,t.body)?{fnName:t.name?.text||"",fnParams:t.parameters}:null;if(e.ts.isCallExpression(t)){let r=t.expression;if(!e.ts.isPropertyAccessExpression(r))return null;let n=t.arguments;if(n.length===0)return null;let o=r.expression;if(!e.ts.isIdentifier(o)||o.text!=="React")return null;let i=r.name;return!e.ts.isIdentifier(i)||i.text!=="forwardRef"?null:Pe(e,n[0])}return null}async function Ot(e){let t=[],r=async n=>{let o=await e.readdir(n);await Promise.all(o.map(async i=>{if(i.startsWith(".")||i==="node_modules"||e.appDir&&hr.has(i))return;let a=e.join(n,i);if(a===e.nextConfigPath||a===e.registryPath||a===e.builderComponentPath)return;let s=await e.stat(a);if(s.isFile()){let c=await re(e,a);c&&t.push(...c)}else if(s.isDirectory()){if(i==="pages"&&e.pagesDir&&a===e.pagesDir)return;await r(a)}}))};return await r(e.getRootDir()),t}var hr=new Set(["default.tsx","default.ts","default.jsx","default.js","error.tsx","error.ts","error.jsx","error.js","layout.tsx","layout.ts","layout.jsx","layout.js","loading.tsx","loading.ts","loading.jsx","loading.js","not-found.tsx","not-found.ts","not-found.jsx","not-found.js","page.tsx","page.ts","page.jsx","page.js","route.tsx","route.ts","route.jsx","route.js","template.tsx","template.ts","template.jsx","template.js"]);function oe(e,t){let r=[],n=[],o=[],i=[];for(let a of t.statements){if(e.ts.isImportDeclaration(a)){if(e.ts.isStringLiteral(a.moduleSpecifier)){let c=a.moduleSpecifier.text;if(!c.startsWith(".")&&!c.startsWith("/")){r.push(a);continue}}let s=a.importClause;if(s){if(s.namedBindings){n.push(a);continue}if(s.name){n.push(a);continue}}o.push(a);continue}i.push(a)}return e.ts.factory.updateSourceFile(t,[...Je(e,r),...Je(e,n),...Je(e,o),...i])}function J(e){let t=e.split(`
`).map(n=>n.trimEnd());e="";let r=!1;for(let n=t.length-1;n>=0;n--){let o=t[n];!r&&o.startsWith("import ")&&(r=!0,o=o+`
`),/^builder.init(.*)$/.test(o)&&(o=o+`
`),t[n-1]&&!t[n-1].includes("*/")&&(o.trim().startsWith("Builder.registerComponent")&&(o=`
`+o),o.trim().startsWith("/**")&&(o=`
`+o),o.trim().startsWith("module.exports")&&(o=`
`+o),o.trim().startsWith("export ")&&(o=`
`+o)),e=o+`
`+e}return e.trim()+`
`}function Je(e,t){return t.sort((r,n)=>{let o=_t(e,r),i=_t(e,n);return o.toLocaleLowerCase().localeCompare(i.toLocaleLowerCase())})}function _t(e,t){let r=t.importClause;if(r){let n=r.namedBindings;if(n&&e.ts.isNamedImports(n)&&n.elements.length>0)return n.elements[0].name.text;if(r.name)return r.name.text}return t.moduleSpecifier&&e.ts.isStringLiteral(t.moduleSpecifier)?t.moduleSpecifier.text:""}function Bt(e){return typeof e=="string"&&!e.includes("'use client'")&&!e.includes(`"use client"'`)&&(e=`"use client"
${e}`),e}function Vt(e,t){let r=t.statements.filter(n=>!(e.ts.isExpressionStatement(n)&&e.ts.isStringLiteral(n.expression)&&e.ts.isStringLiteral(n.expression)&&n.expression.text==="use client"));return e.ts.factory.updateSourceFile(t,r)}function Ne(e,t){return t.sort((r,n)=>{if(e.ts.isObjectLiteralExpression(r)&&e.ts.isObjectLiteralExpression(n)){let o=jt(e,r),i=jt(e,n);return o.toLocaleLowerCase().localeCompare(i.toLocaleLowerCase())}return 1})}function jt(e,t){let r=t.properties.find(n=>D(e,n)==="name");return r&&e.ts.isPropertyAssignment(r)&&e.ts.isStringLiteral(r.initializer)?r.initializer.text:"zzzz"}async function $t(e){let t=await e.readFile(e.registryPath);return t?Cr(e,t):{components:[],sourceFile:E(e,"")}}async function Cr(e,t){let r=E(e,t);return wr(e,r)}async function wr(e,t){let r=[];for(let n=0;n<t.statements.length;n++){let o=t.statements[n];if(!e.ts.isExpressionStatement(o))continue;let i=o.expression;if(!e.ts.isCallExpression(i))continue;let a=i.expression;if(!e.ts.isPropertyAccessExpression(a))continue;let s=a.expression;if(!e.ts.isIdentifier(s)||s.text!=="Builder"||a.name.text!=="registerComponent")continue;let u=i.arguments;if(u.length<2)continue;let d=u[1];if(!e.ts.isObjectLiteralExpression(d))continue;let f=u[0];if(e.ts.isCallExpression(f)){let p=await yr(e,n,f,d);p&&r.push(p);continue}if(e.ts.isIdentifier(f)){let p=await Er(e,t,n,f,d);p&&r.push(p);continue}}return{sourceFile:t,components:K(r)}}async function yr(e,t,r,n){let o={id:"",name:"",displayFilePath:"",exportName:"",importName:"",filePath:"",inputs:[],nodeIndex:t},i=r.arguments;if(i.length===0)return null;let a=i[0];if(!e.ts.isArrowFunction(a))return null;let s=a.body;if(e.ts.isCallExpression(s)){if(s.expression.kind!==e.ts.SyntaxKind.ImportKeyword||s.arguments.length!==1)return null;let u=s.arguments[0];if(!e.ts.isStringLiteral(u))return null;let d=u.text;o.filePath=await Re(e,d),o.name=M(e,o.filePath),o.importName="default",o.exportName="default",o.exportType="default"}else if(e.ts.isPropertyAccessExpression(s)){let c=s.expression;if(!e.ts.isParenthesizedExpression(c))return null;let u=c.expression;if(!e.ts.isAwaitExpression(u))return null;let d=u.expression;if(!e.ts.isCallExpression(d)||d.expression.kind!==e.ts.SyntaxKind.ImportKeyword||d.arguments.length!==1)return null;let p=d.arguments[0];if(!e.ts.isStringLiteral(p)||!e.ts.isIdentifier(s.name))return null;let l=p.text;o.filePath=await Re(e,l),o.name=F(s.name.text),o.importName=s.name.text,o.exportName=s.name.text,o.exportType="named"}else return null;return o=Y(e,o,n),o.displayFilePath=b(e,o.filePath),o.filePath&&o.exportName&&(o.id=await L(e,o.filePath,o.exportName)),o}async function Er(e,t,r,n,o){let i={id:"",name:"",displayFilePath:"",exportName:"",importName:"",filePath:"",inputs:[],nodeIndex:r},a=t.statements.filter(c=>e.ts.isImportDeclaration(c)),s=a.find(c=>c.importClause&&c.importClause.name?.text===n.text);if(s){let c=s.moduleSpecifier;if(!e.ts.isStringLiteral(c))return null;i.filePath=await Re(e,c.text),i.name=M(e,i.filePath),i.importName=n.text,i.exportName="default",i.exportType="default"}else{let c=a.find(d=>!d.importClause||!d.importClause.namedBindings||!e.ts.isNamedImports(d.importClause.namedBindings)?!1:d.importClause.namedBindings.elements.some(f=>f.name.text===n.text));if(!c)return null;let u=c.moduleSpecifier;if(!e.ts.isStringLiteral(u))return null;i.filePath=await Re(e,u.text),i.name=F(n.text),i.importName=n.text,i.exportName=n.text,i.exportType="named"}return i=Y(e,i,o),i.displayFilePath=b(e,i.filePath),i.filePath&&i.exportName&&(i.id=await L(e,i.filePath,i.exportName)),i}function Re(e,t){return qe(e,e.normalize(e.resolve(e.dirname(e.registryPath),t)))}function ie(e,t){let r=[...t.statements],n=!1;for(let o=t.statements.length-1;o>=0;o--){let i=t.statements[o];if(e.ts.isImportDeclaration(i)&&i.importClause){let a=!1,s=i.importClause.namedBindings;if(s&&e.ts.isNamedImports(s)&&s.elements){let c=[...s.elements];for(let u=c.length-1;u>=0;u--){let d=c[u];if(e.ts.isImportSpecifier(d)){let f=d.name;if(f&&e.ts.isIdentifier(f)){let p=f.text;zt(e,t,p)||c.splice(u,1)}}}if(c.length===0)a=!0;else if(s.elements.length!==c.length){let u=e.ts.factory.updateImportClause(i.importClause,!1,i.importClause.name,e.ts.factory.createNamedImports(c)),d=e.ts.factory.updateImportDeclaration(i,void 0,u,i.moduleSpecifier,void 0);r[o]=d,n=!0}}else if(i.importClause.name&&e.ts.isIdentifier(i.importClause.name)){let c=i.importClause.name.text;zt(e,t,c)||(a=!0)}a&&(r.splice(o,1),n=!0)}}return n?e.ts.factory.updateSourceFile(t,r):t}function zt(e,t,r){let n=!1;function o(i){if(!e.ts.isImportDeclaration(i)){if(e.ts.isIdentifier(i)&&i.text===r){n=!0;return}e.ts.forEachChild(i,o)}}return e.ts.forEachChild(t,o),n}function ae(e,t,r,n,o,i,a){let s=null,c=null,u=null,d=-1;t=k(t),r=k(r);let f=t.find(l=>l.id===e),p=r.find(l=>l.id===e);if(n)p||(s={...k(f),inputs:k(f.inputs).map(l=>(l.isRegistered=!0,l))},d=r.length,r.push(s));else if(typeof p?.nodeIndex=="number"&&p.nodeIndex>-1){if(o)d=p.nodeIndex,c=k(p),r=r.filter(l=>l.id!==e);else if(i!=null)Dr(p,i),d=p.nodeIndex,u=p;else if(a!=null){let l=p.inputs.find(m=>m.name===a.name);l&&(a.registerInput===!1?l.isRegistered=!1:(vr(l,a),l.isRegistered=!0),u=p,d=p.nodeIndex)}}return{addCmpToRegistry:s,removeCmpFromRegistry:c,updateRegisteredCmp:u,nodeIndex:d,components:G(t,r)}}function G(e,t){let r=K([...t.map(n=>(n.isRegistered=!0,n)),...e.filter(n=>!t.some(o=>o.id===n.id)).map(n=>(n.isRegistered=!1,n))]);return r.forEach(n=>{n.inputs.sort((o,i)=>o.name.toLowerCase().localeCompare(i.name.toLowerCase()))}),r}function Dr(e,t){A(t.name)?e.name=t.name:t.name===null&&(e.name=e.importName),A(t.description)?e.description=t.description:t.description===null&&delete e.description,A(t.image)?e.image=t.image:t.image===null&&delete e.image}function vr(e,t){A(t.type)&&(e.type=t.type),A(t.friendlyName)?e.friendlyName=t.friendlyName:t.friendlyName===null&&delete e.friendlyName,A(t.defaultValue)||Ce(t.defaultValue)||fe(t.defaultValue)?e.defaultValue=t.defaultValue:t.defaultValue===null&&delete e.defaultValue,A(t.helperText)?e.helperText=t.helperText:t.helperText===null&&delete e.helperText,t.required===!0?e.required=t.required:(t.required===null||t.required===!1)&&delete e.required}async function _(e,t,r,n,o,i,a){let[s,c]=await Promise.all([Ot(e),$t(e)]),u=s.map(p=>p.cmpInfo),d=c.components,f={components:G(u,d),registryPath:e.registryPath,registryDisplayPath:b(e,e.registryPath)};if(t!=null){let p=s.find(C=>C.cmpInfo.id===t);if(!p)throw new Error(`Component ${t} not found`);let l=c.sourceFile,m=f.components.find(C=>C.id===t),x=await Ie(e,p);H(m,x);let S=ae(t,u,d,r,n,o,i),g=[...l.statements],h=!1;if(S.addCmpToRegistry?(g.push(Nt(e,S.addCmpToRegistry)),h=!0):S.removeCmpFromRegistry?(g.splice(S.nodeIndex,1),h=!0):S.updateRegisteredCmp&&(g[S.nodeIndex]=Me(e,g[S.nodeIndex],S.updateRegisteredCmp),h=!0),h&&a){if(l=e.ts.factory.updateSourceFile(l,g),l=I(e,l,{namedImports:["Builder"],importPath:"@builder.io/react"}),e.appDir){let w=S.addCmpToRegistry||S.updateRegisteredCmp;if(w){let v=R(e,e.registryPath,w.filePath);w.exportType==="default"?l=I(e,l,{defaultImport:w.importName,importPath:v}):w.exportType==="named"&&(l=I(e,l,{namedImports:[w.importName],importPath:v}))}}else l=I(e,l,{defaultImport:"dynamic",importPath:"next/dynamic"});l=ie(e,l),l=oe(e,l),e.appDir&&(l=Vt(e,l));let C=P(e,l);C=J(C),e.appDir&&(C=Bt(C)),C=await e.formatCode(e.registryPath,C),await e.writeFile(e.registryPath,C)}f.components=S.components}return f}async function Ut(e){let t=[],r=await Rr(e,t);return await Lr(e,r,t),e.appDir?(e.debug(`ensure builder setup for next.js app ${e.appDir}`),await Tr(e,e.appDir,t)):e.pagesDir&&(e.debug(`ensure builder setup for next.js pages ${e.pagesDir}`),await Ir(e,e.pagesDir,t)),t}async function Tr(e,t,r){let n=`page.${e.typescriptEnabled?"tsx":"jsx"}`,o=e.join(t,"[...page]",n);if(!await e.exists(o)){let i=await e.formatCode(o,Pr(e,o));await e.writeFile(o,i),r.push({filePath:o,modifiedType:"create"})}if(!await e.exists(e.builderComponentPath)){let i=await e.formatCode(e.builderComponentPath,br(e));await e.writeFile(e.builderComponentPath,i),r.push({filePath:e.builderComponentPath,modifiedType:"create"})}}function br(e){let t=e.typescriptEnabled;return`
"use client";
import { BuilderComponent, useIsPreviewing } from "@builder.io/react"; 
import { ${t?"BuilderContent, ":""}builder } from '@builder.io/sdk';
import DefaultErrorPage from "next/error";
import ${JSON.stringify(R(e,e.builderComponentPath,e.registryPath))};
${t?`
interface BuilderPageProps { 
  content?: BuilderContent;
}`:""}

// Builder Public API Key set in .env file
builder.init(process.env.${pe}${t?"!":""});

export function RenderBuilderContent({ content }${t?": BuilderPageProps":""}) { 
  // Call the useIsPreviewing hook to determine if 
  // the page is being previewed in Builder
  const isPreviewing = useIsPreviewing(); 
  // If "content" has a value or the page is being previewed in Builder,
  // render the BuilderComponent with the specified content and model props.
  if (content || isPreviewing) {
    return <BuilderComponent content={content} model="page" />;
  }
  // If the "content" is falsy and the page is 
  // not being previewed in Builder, render the 
  // DefaultErrorPage with a 404.
  return <DefaultErrorPage statusCode={404} />; 
}  
`.trimStart()}function Pr(e,t){let r=e.typescriptEnabled,n=R(e,t,e.builderComponentPath);return`
import { builder } from "@builder.io/sdk";
import { RenderBuilderContent } from ${JSON.stringify(n)};

// Builder Public API Key set in .env file
builder.init(process.env.${pe}${r?"!":""});
${r?`
interface PageProps {
  params: {
    page: string[];
  };
}`:""}

export default async function Page(props${r?": PageProps":""}) {
  const content = await builder
    // Get the page content from Builder with the specified options
    .get("page", {
      userAttributes: {
        // Use the page path specified in the URL to fetch the content
        urlPath: "/" + (props?.params?.page?.join("/") || ""),
      },
    })
    // Convert the result to a promise
    .toPromise();

  return (
    <>
      {/* Render the Builder page */}
      <RenderBuilderContent content={content} />
    </>
  );
}
`.trimStart()}async function Ir(e,t,r){let n=`[...page].${e.typescriptEnabled?"tsx":"jsx"}`,o=e.join(t,n);if(!await e.exists(o)){let i=await e.formatCode(o,Nr(e,o));await e.writeFile(o,i),r.push({filePath:o,modifiedType:"create"})}}function Nr(e,t){let r=e.typescriptEnabled;return`
import React from "react";
import { useRouter } from "next/router";
import { BuilderComponent, builder, useIsPreviewing } from "@builder.io/react";
import DefaultErrorPage from "next/error";
import Head from "next/head";${r?`
import { BuilderContent } from "@builder.io/sdk";`:""}${r?`
import { GetStaticProps } from "next";`:""}
import ${JSON.stringify(R(e,t,e.registryPath))};

builder.init(process.env.${pe}${r?"!":""});

// Define a function that fetches the Builder
// content for a given page
export const getStaticProps${r?": GetStaticProps":""} = async ({ params }) => {
  // Fetch the builder content for the given page
  const page = await builder
    .get("page", {
      userAttributes: {
        urlPath: "/" + ((params?.page as string[])?.join("/") || ""),
      },
    })
    .toPromise();

  // Return the page content as props
  return {
    props: {
      page: page || null,
    },
    // Revalidate the content every 5 seconds
    revalidate: 5,
  };
};

// Define a function that generates the
// static paths for all pages in Builder
export async function getStaticPaths() {
  // Get a list of all pages in Builder
  const pages = await builder.getAll("page", {
    // We only need the URL field
    fields: "data.url",
    options: { noTargeting: true },
  });

  // Generate the static paths for all pages in Builder
  return {
    paths: pages.map((page) => String(page.data?.url)).filter(url => url !== '/'),
    fallback: 'blocking',
  };
}

// Define the Page component
export default function Page({ page }${r?": { page: BuilderContent | null }":""}) {
  const router = useRouter();
  const isPreviewing = useIsPreviewing();

  // If the page content is not available
  // and not in preview mode, show a 404 error page
  if (!page && !isPreviewing) {
    return <DefaultErrorPage statusCode={404} />;
  }

  // If the page content is available, render
  // the BuilderComponent with the page content
  return (
    <>
      <Head>
        <title>{page?.data?.title}</title>
      </Head>
      {/* Render the Builder page */}
      <BuilderComponent model="page" content={page || undefined} />
    </>
  );
}
`.trimStart()}async function Rr(e,t){let n=e.typescriptEnabled?"tsx":"jsx",o=e.join(e.componentsDir,"Counter"),i=e.join(o,`Counter.${n}`),a=e.join(o,"styles.module.css"),{component:s,styles:c}=Fr(e);if(!await e.exists(i)){let u=await e.formatCode(i,s);await e.writeFile(i,u),t.push({filePath:i,modifiedType:"create"})}return await e.exists(a)||(await e.writeFile(a,c),t.push({filePath:a,modifiedType:"create"})),i}function Fr(e){let t=e.typescriptEnabled,r=`
"use client"
import React, { useState } from "react";
import styles from "./styles.module.css";
${t?`
interface CounterProps {
  initialCount?: number;
}`:""}

function Counter({ initialCount = 99 }${t?": CounterProps":""}) {
  const [count, setCount] = useState(initialCount);

  const increment = () => {
    setCount((prevCount) => prevCount + 1);
  };

  const decrement = () => {
    setCount((prevCount) => prevCount - 1);
  };

  return (
    <div className={styles.counter}>
      <button className={styles.btn} onClick={decrement}>
        -
      </button>
      <span className={styles.count}>{count}</span>
      <button className={styles.btn} onClick={increment}>
        +
      </button>
    </div>
  );
}

export default Counter;
`.trimStart(),n=`
.counter {
  margin: 32px auto;
  display: flex;
  width: 100%;
  max-width: 190px;
}

.btn {
  width: 42px;
  font-size: 32px;
  font-weight: bold;
  background-color: #1c6bd1;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  line-height: 1.4;
}

.btn:hover {
  opacity: 0.8;
}

.count {
  flex: 1;
  font-size: 42px;
  text-align: center;
}
`.trimStart();return{component:r,styles:n}}async function Lr(e,t,r){await e.exists(e.registryPath)||(await e.writeFile(e.registryPath,""),r.push({filePath:e.registryPath,modifiedType:"create"}));let o=(await _(e,null,!1,!1,null,null,!1)).components.find(i=>i.filePath===t);o&&await _(e,o.id,!0,!1,null,null,!0)}async function Mt(e){let t=await kr(e);return{builderPageOptions:async()=>({templateContentId:"3de2f13211234071a4b19a17b4fbc5a7",pathname:"/builder-demo",title:"Builder Demo Page"}),ensureBuilderSetup:()=>Ut(t),getFrameworks:()=>e.frameworks||[],getRegistryPath:()=>t.registryPath,getRegistry:()=>_(t,null,!1,!1,null,null,!1),loadComponent:async n=>{let o=await _(t,n.cmpId,!1,!1,null,null,!1);return{...o,component:o.components.find(i=>i.id===n.cmpId)}},registerComponent:n=>_(t,n.cmpId,!0,!1,null,null,!0),setRegisteredComponentInfo:n=>_(t,n.cmpId,!1,!1,n,null,!0),setRegisteredComponentInput:n=>_(t,n.cmpId,!1,!1,null,n,!0),unregisterComponent:n=>_(t,n.cmpId,!1,!0,null,null,!0),getPublicApiKey:()=>Ve(t),setPublicApiKey:n=>Dt(t,n.publicApiKey),getDependencies:()=>[{name:"@builder.io/dev-tools"},{name:"@builder.io/react"},{name:"@builder.io/sdk"}],getDevRunCommand:()=>"dev"}}async function kr(e){let t=e.getRootDir(),r=e.join(t,"src"),n=await Or(e),o=await Ar(e),i=`builder-registry.${o?"ts":"js"}`,a={...e,appDir:null,pagesDir:null,srcDir:null,builderComponentPath:"",componentsDir:"",registryPath:"",nextConfigPath:n,typescriptEnabled:o};if(await e.exists(r)){a.srcDir=r,a.componentsDir=e.join(r,"components");let s=e.join(r,"app");await e.exists(s)&&(a.appDir=s);let c=e.join(r,"pages");await e.exists(c)&&(a.pagesDir=c),a.registryPath=e.join(r,i)}else a.componentsDir=e.join(t,"components"),a.registryPath=e.join(t,i);if(a.builderComponentPath=e.join(a.componentsDir,`builder.${o?"tsx":"jsx"}`),!a.appDir){let s=e.join(t,"app");await e.exists(s)&&(a.appDir=s)}if(!a.pagesDir){let s=e.join(t,"pages");await e.exists(s)&&(a.pagesDir=s)}if(!a.appDir&&!a.pagesDir)throw new Error(`Could not find Next.js "app" or "pages" directory. Searched in "${t}".`);return a}function Ar(e){let t=e.join(e.getRootDir(),"tsconfig.json");return e.exists(t)}async function Or(e){let t=e.join(e.getRootDir(),"next.config.ts");if(await e.exists(t))return t;let r=e.join(e.getRootDir(),"next.config.js");if(await e.exists(r))return r;throw new Error(`Could not find Next.js config file. Searched for "next.config.ts" and "next.config.js" in "${e.getRootDir()}".`)}async function We(e){return await te(e,[".env"],Qt)}async function Kt(e,t){_r(t);let r=await We(e),n=await ne(e,r.file,r.envKey,t);return{...r,modifiedType:n}}function _r(e){typeof process<"u"&&(process.env[Qt]=e)}var Qt="PUBLIC_BUILDER_API_KEY";function qt(e,t,r){if(r.length===0)return e;let n=e.split(`
`),o=n.findIndex(s=>s.includes(r));if(o===-1||n.some(s=>s.includes(t[0])))return e;let a=["/**",...t.map(s=>` * ${s.trim()}`)," */"];return n.splice(o,0,...a),n.join(`
`)}function Fe(e,t,r){return Qe(e,t,r.variableName)?t:jr(e,t,r)}function jr(e,t,r){let n=typeof r.arrayType=="string"?e.ts.factory.createArrayTypeNode(e.ts.factory.createTypeReferenceNode(r.arrayType,void 0)):void 0,o=e.ts.factory.createArrayLiteralExpression([]),i=e.ts.factory.createVariableDeclaration(r.variableName,void 0,n,o),a=e.ts.factory.createVariableDeclarationList([i],e.ts.NodeFlags.Const),s=e.ts.factory.createModifier(e.ts.SyntaxKind.ExportKeyword),c=e.ts.factory.createVariableStatement([s],a),u=[...t.statements,c];return e.ts.factory.updateSourceFile(t,u)}async function Wt(e){let t=[],r=async n=>{let o=await e.readdir(n);await Promise.all(o.map(async i=>{if(i.startsWith(".")||i==="node_modules"||i==="layout.tsx"||i==="404.tsx"||i==="router-head.tsx")return;let a=e.join(n,i);if(a===e.registryPath)return;let s=await e.stat(a);if(s.isFile()){let c=await Ye(e,a);c&&t.push(...c)}else s.isDirectory()&&await r(a)}))};return await r(e.componentsDir),t}async function Ye(e,t){if(e.extname(t).toLowerCase()===".tsx"){let n=await e.readFile(t);if(n)return Br(e,t,n)}return null}function Br(e,t,r){let n=E(e,r);return He(e,t,n)}async function He(e,t,r){t=e.normalize(t);let n=[],o=O(e,r);return await Promise.all(o.map(async i=>{let a=await Vr(e,t,i);a&&n.push(a)})),n}async function Vr(e,t,r){if(e.ts.isVariableStatement(r.node))for(let n of r.node.declarationList.declarations){let o=Jt(e,n.initializer);if(o&&e.ts.isIdentifier(n.name)){let i=n.name.text;return{cmpInfo:{id:await L(e,t,i),displayFilePath:b(e,t),name:F(i),inputs:[],exportName:i,exportType:"named",importName:i,filePath:t},node:o}}}else if(e.ts.isCallExpression(r.node)){let n=Jt(e,r.node);if(n)return{cmpInfo:{id:await L(e,t,"default"),displayFilePath:b(e,t),name:M(e,t),inputs:[],exportName:"default",exportType:"default",importName:ue(e,t),filePath:t},node:n}}return null}function Jt(e,t){if(t&&e.ts.isCallExpression(t)&&e.ts.isIdentifier(t.expression)&&t.expression.text==="component$"&&t.arguments.length>0){let r=t.arguments[0];if(e.ts.isArrowFunction(r)||e.ts.isFunctionExpression(r))return{callExpression:t,qwikFnParams:r.parameters}}return null}async function Yt(e,t){if(t.node.qwikFnParams.length>0){let{sourceFile:r,typeChecker:n}=await be(e,t.cmpInfo.filePath),i=(await He(e,t.cmpInfo.filePath,r)).find(a=>a.cmpInfo.id===t.cmpInfo.id);if(!i)throw new Error(`createComponentInputs() Could not find component ${t.cmpInfo.name} in ${t.cmpInfo.filePath}`);return ye(e,n,i.node.qwikFnParams[0])}return[]}async function Ht(e){return Ge(e)}async function Ge(e){let t=[];return await e.exists(e.registryPath)||(await e.writeFile(e.registryPath,$r),t.push({filePath:e.registryPath,modifiedType:"create"})),t}var $r=`import type { RegisteredComponent } from "@builder.io/sdk-qwik";

export const CUSTOM_COMPONENTS: RegisteredComponent[] = [
];
`;async function Gt(e){await Ge(e);let t=await e.readFile(e.registryPath);return t?zr(e,t):{components:[],sourceFile:E(e,"")}}async function zr(e,t){let r=E(e,t);return Ur(e,r)}async function Ur(e,t){let r=[],n=q(e,t,"CUSTOM_COMPONENTS");return n&&await Promise.all(n.arrayLiteralExp.elements.map(async(o,i)=>{let a=await Xe(e,t,o);a&&(a.nodeIndex=i,r.push(a))})),{sourceFile:t,components:K(r)}}async function Xe(e,t,r){if(!e.ts.isObjectLiteralExpression(r))return null;let n={id:"",name:"",displayFilePath:"",exportName:"",importName:"",filePath:"",inputs:[]};for(let o of r.properties){if(!e.ts.isPropertyAssignment(o)||!e.ts.isIdentifier(o.name))continue;if(D(e,o)==="component"&&e.ts.isIdentifier(o.initializer)){let a=o.initializer.text;n.name===""&&(n.name=F(a)),n.importName=a;let s=await Ee(e,e.registryPath,t,a);if(!s)continue;n.filePath=s.filePath,n.displayFilePath=s.displayFilePath,n.exportType=s.exportType;let c=await Ye(e,s.filePath);if(c&&c.length>0)if(c.length===1)n.exportName=c[0].cmpInfo.exportName;else{let u=c.find(d=>d.cmpInfo.exportName===a);u&&(n.exportName=u.cmpInfo.exportName)}continue}}return n=Y(e,n,r),n.filePath&&n.exportName&&(n.id=await L(e,n.filePath,n.exportName)),n}async function X(e,t,r,n,o,i,a){let[s,c]=await Promise.all([Wt(e),Gt(e)]),u=s.map(p=>p.cmpInfo),d=c.components,f={components:G(u,d),registryPath:e.registryPath,registryDisplayPath:b(e,e.registryPath)};if(t!=null){let p=s.find(T=>T.cmpInfo.id===t);if(!p)throw new Error(`Component ${t} not found`);let l=c.sourceFile,m=f.components.find(T=>T.id===t),x=await Yt(e,p);H(m,x);let S=ae(t,u,d,r,n,o,i),{elements:g,elmIndex:h,statementIndex:C,statement:w,variableDeclaration:v}=await Kr(e,l,p),y=!1;if(S.addCmpToRegistry?(g.push(Mr(e,S.addCmpToRegistry)),y=!0):S.removeCmpFromRegistry?(g.splice(h,1),y=!0):S.updateRegisteredCmp&&(g[h]=Q(e,g[h],S.updateRegisteredCmp),y=!0),y&&a){let T=[...l.statements];T[C]=e.ts.factory.updateVariableStatement(w,w.modifiers,e.ts.factory.updateVariableDeclarationList(w.declarationList,[e.ts.factory.updateVariableDeclaration(v,v.name,v.exclamationToken,v.type,e.ts.factory.createArrayLiteralExpression(Ne(e,g)))])),l=e.ts.factory.updateSourceFile(l,T),m.exportType==="named"?l=I(e,l,{namedImports:[m.importName],importPath:R(e,e.registryPath,m.filePath)}):l=I(e,l,{defaultImport:m.importName,importPath:R(e,e.registryPath,m.filePath)}),l=I(e,l,{namedImports:["RegisteredComponent"],importPath:"@builder.io/sdk-qwik",isTypeOnly:!0}),l=Fe(e,l,{variableName:"CUSTOM_COMPONENTS",arrayType:"RegisteredComponent"}),l=ie(e,l),l=oe(e,l);let N=P(e,l);N=J(N),N=qt(N,Qr,"CUSTOM_COMPONENTS"),N=await e.formatCode(e.registryPath,N),await e.writeFile(e.registryPath,N)}f.components=S.components}return f}function Mr(e,t){return Q(e,e.ts.factory.createObjectLiteralExpression([e.ts.factory.createPropertyAssignment("component",e.ts.factory.createIdentifier(t.importName))],!0),t)}async function Kr(e,t,r){let n=q(e,t,"CUSTOM_COMPONENTS");if(!n)throw new Error(`Exported name of the Builder registry must be "CUSTOM_COMPONENTS". Please update your Builder registry file: ${e.registryPath}`);let o=n.arrayLiteralExp.elements.filter(a=>e.ts.isObjectLiteralExpression(a)),i=-1;for(let a=0;a<o.length;a++)if((await Xe(e,t,o[a]))?.id===r.cmpInfo.id){i=a;break}return{...n,elements:o,elmIndex:i}}var Qr=["This array is used to integrate custom components within Builder.","https://www.builder.io/c/docs/custom-components-intro","",'These components will be found the "Custom Components"',"section of Builder's visual editor.",'You can also turn on "components only mode" to limit',"editing to only these components.","https://www.builder.io/c/docs/guides/components-only-mode"];async function Xt(e){let t=await qr(e);return{builderPageOptions:async()=>({templateContentId:"dc70f1d979ad416d8fd357137eb9ddfb",pathname:"/",title:"Home"}),ensureBuilderSetup:()=>Ht(t),getFrameworks:()=>e.frameworks||[],getRegistryPath:()=>t.registryPath,getRegistry:()=>X(t,null,!1,!1,null,null,!1),loadComponent:async n=>{let o=await X(t,n.cmpId,!1,!1,null,null,!1);return{...o,component:o.components.find(i=>i.id===n.cmpId)}},registerComponent:n=>X(t,n.cmpId,!0,!1,null,null,!0),setRegisteredComponentInfo:n=>X(t,n.cmpId,!1,!1,n,null,!0),setRegisteredComponentInput:n=>X(t,n.cmpId,!1,!1,null,n,!0),unregisterComponent:n=>X(t,n.cmpId,!1,!0,null,null,!0),getPublicApiKey:()=>We(t),setPublicApiKey:n=>Kt(t,n.publicApiKey),getDependencies:()=>[{name:"@builder.io/dev-tools"},{name:"@builder.io/sdk-qwik"}],getDevRunCommand:()=>"dev"}}async function qr(e){let t=await le(e,e.getRootDir(),"components");if(!t)throw new Error(`Could not find components directory within project: ${e.getRootDir()}`);let r=e.join(t,"builder-registry.ts"),n=e.join(e.getRootDir(),".env");return{...e,componentsDir:t,registryPath:r,envPath:n}}async function Ze(e){return await te(e,[".env"],et)}async function Zt(e,t){let r=await Ze(e),n=await ne(e,r.file,r.envKey,t);return{...r,modifiedType:n}}var et="PUBLIC_BUILDER_KEY";async function en(e){let t=[],r=e.join(e.getRootDir(),"build"),n=async o=>{let i=await e.readdir(o);await Promise.all(i.map(async a=>{if(a.startsWith(".")||a==="node_modules"||Jr.has(a)||a.includes("$."))return;let s=e.join(o,a);if(s===e.remixConfigPath||s===e.registryPath||s===r)return;let c=await e.stat(s);if(c.isFile()){let u=await re(e,s);u&&t.push(...u)}else c.isDirectory()&&await n(s)}))};return await n(e.getRootDir()),t}var Jr=new Set(["root.tsx","root.ts","root.jsx","root.js","_index.tsx","_index.jsx","_index.ts","_index.js"]);async function tn(e){await nt(e);let t=await e.readFile(e.registryPath);return t?Wr(e,t):{components:[],sourceFile:E(e,"")}}async function Wr(e,t){let r=E(e,t);return Yr(e,r)}async function Yr(e,t){let r=[],n=q(e,t,"CUSTOM_COMPONENTS");return n&&await Promise.all(n.arrayLiteralExp.elements.map(async(o,i)=>{let a=await tt(e,t,o);a&&(a.nodeIndex=i,r.push(a))})),{sourceFile:t,components:K(r)}}async function tt(e,t,r){if(!e.ts.isObjectLiteralExpression(r))return null;let n={id:"",name:"",displayFilePath:"",exportName:"",importName:"",filePath:"",inputs:[]};for(let o of r.properties){if(!e.ts.isPropertyAssignment(o)||!e.ts.isIdentifier(o.name))continue;if(D(e,o)==="component"&&e.ts.isIdentifier(o.initializer)){let a=o.initializer.text;n.name===""&&(n.name=F(a)),n.importName=a;let s=await Ee(e,e.registryPath,t,a);if(!s)continue;n.filePath=s.filePath,n.displayFilePath=s.displayFilePath,n.exportType=s.exportType;let c=await re(e,s.filePath);if(c&&c.length>0)if(c.length===1)n.exportName=c[0].cmpInfo.exportName;else{let u=c.find(d=>d.cmpInfo.exportName===a);u&&(n.exportName=u.cmpInfo.exportName)}continue}}return n=Y(e,n,r),n.filePath&&n.exportName&&(n.id=await L(e,n.filePath,n.exportName)),n}async function j(e,t,r,n,o,i,a){let[s,c]=await Promise.all([en(e),tn(e)]),u=s.map(p=>p.cmpInfo),d=c.components,f={components:G(u,d),registryPath:e.registryPath,registryDisplayPath:b(e,e.registryPath)};if(t!=null){let p=s.find(T=>T.cmpInfo.id===t);if(!p)throw new Error(`Component ${t} not found`);let l=c.sourceFile,m=f.components.find(T=>T.id===t),x=await Ie(e,p);H(m,x);let S=ae(t,u,d,r,n,o,i),{elements:g,elmIndex:h,statementIndex:C,statement:w,variableDeclaration:v}=await Gr(e,l,p),y=!1;if(S.addCmpToRegistry?(g.push(Hr(e,S.addCmpToRegistry)),y=!0):S.removeCmpFromRegistry?(g.splice(h,1),y=!0):S.updateRegisteredCmp&&(g[h]=Q(e,g[h],S.updateRegisteredCmp),y=!0),y&&a){let T=[...l.statements];T[C]=e.ts.factory.updateVariableStatement(w,w.modifiers,e.ts.factory.updateVariableDeclarationList(w.declarationList,[e.ts.factory.updateVariableDeclaration(v,v.name,v.exclamationToken,v.type,e.ts.factory.createArrayLiteralExpression(Ne(e,g)))])),l=e.ts.factory.updateSourceFile(l,T),m.exportType==="named"?l=I(e,l,{namedImports:[m.importName],importPath:R(e,e.registryPath,m.filePath)}):l=I(e,l,{defaultImport:m.importName,importPath:R(e,e.registryPath,m.filePath)}),l=I(e,l,{namedImports:["RegisteredComponent"],importPath:"@builder.io/react",isTypeOnly:!0}),l=Fe(e,l,{variableName:"CUSTOM_COMPONENTS",arrayType:"RegisteredComponent"}),l=ie(e,l),l=oe(e,l);let N=P(e,l);N=J(N),N=await e.formatCode(e.registryPath,N),await e.writeFile(e.registryPath,N)}f.components=S.components}return f}function Hr(e,t){return Q(e,e.ts.factory.createObjectLiteralExpression([e.ts.factory.createPropertyAssignment("component",e.ts.factory.createIdentifier(t.importName))],!0),t)}async function Gr(e,t,r){let n=q(e,t,"CUSTOM_COMPONENTS");if(!n)throw new Error(`Exported name of the Builder registry must be "CUSTOM_COMPONENTS". Please update your Builder registry file: ${e.registryPath}`);let o=n.arrayLiteralExp.elements.filter(a=>e.ts.isObjectLiteralExpression(a)),i=-1;for(let a=0;a<o.length;a++)if((await tt(e,t,o[a]))?.id===r.cmpInfo.id){i=a;break}return{...n,elements:o,elmIndex:i}}async function nn(e){let t=[],r=await eo(e,t);return t.push(...await nt(e)),await no(e,r),await Xr(e,t),t}async function Xr(e,t){let r=`$.${e.typescriptEnabled?"tsx":"jsx"}`,n=e.join(e.routesDir,r),o=await e.exists(n);if(e.debug(`remixEnsureAppRoute, hasRoute: ${o}`),!o){let i=await e.formatCode(n,Zr(e,n));await e.writeFile(n,i),t.push({filePath:n,modifiedType:"create"})}}function Zr(e,t){let r=e.typescriptEnabled,n=R(e,t,e.registryPath);return`
import { BuilderComponent, builder } from "@builder.io/react";
import { useLoaderData } from "@remix-run/react";
${r?'import type { LoaderArgs } from "@remix-run/node";':""}
import { CUSTOM_COMPONENTS } from ${JSON.stringify(n)};

// Fetch contents of the page
export const loader = async ({ params, request, context }${r?": LoaderArgs":""}) => {
  // Initialize the Builder client and pass in your Public API Key
  builder.init(process.env.${et}${r?"!":""});

  // Fetch data content from Builder.io based on the URL path
  const page = await builder
    .get("page", {
      userAttributes: {
        urlPath: "/" + params["*"],
      },
    })
    .toPromise();

  // Verify the user is previewing or editing in Builder
  const isPreviewing = new URL(request.url).searchParams.has("builder.preview");

  // If the page is not found and the user is not previewing, throw a 404.
  // The CatchBoundary component will catch the error
  if (!page && !isPreviewing) {
    throw new Response("Page Not Found", {
      status: 404,
      statusText:
        "We couldn't find this page, please check your url path and if the page is published on Builder.io.",
    });
  }

  return { page, builderPublicKey: process.env.PUBLIC_BUILDER_KEY${r?"!":""} };
};

// Define and render the page.
export default function Page() {
  // Use the useLoaderData hook to get the Page data from "loader" above.
  const { page, builderPublicKey } = useLoaderData${r?"<typeof loader>":""}();

  // Render the page content from Builder.io
  return (
    <BuilderComponent
      customComponents={CUSTOM_COMPONENTS}
      apiKey={builderPublicKey}
      model="page"
      content={page}
    />
  );
}
`}async function eo(e,t){let n=e.typescriptEnabled?"tsx":"jsx",o=e.join(e.componentsDir,"Counter"),i=e.join(o,`Counter.${n}`),a=e.join(o,"styles.module.css"),{component:s,styles:c}=to(e),u=await e.exists(i);if(e.debug(`remixEnsureCounterComponent, hasCounterCmp: ${u}`),!u){let f=await e.formatCode(i,s);await e.writeFile(i,f),t.push({filePath:i,modifiedType:"create"})}let d=await e.exists(a);return e.debug(`remixEnsureCounterComponent, hasCounterStyles: ${d}`),d||(await e.writeFile(a,c),t.push({filePath:a,modifiedType:"create"})),i}function to(e){let t=e.typescriptEnabled,r=`
import { useState } from "react";
import styles from "./styles.module.css";
${t?`
interface CounterProps {
  initialCount?: number;
}`:""}

function Counter({ initialCount = 99 }${t?": CounterProps":""}) {
  const [count, setCount] = useState(initialCount);

  const increment = () => {
    setCount((prevCount) => prevCount + 1);
  };

  const decrement = () => {
    setCount((prevCount) => prevCount - 1);
  };

  return (
    <div className={styles.counter}>
      <button className={styles.btn} onClick={decrement}>
        -
      </button>
      <span className={styles.count}>{count}</span>
      <button className={styles.btn} onClick={increment}>
        +
      </button>
    </div>
  );
}

export default Counter;
`.trimStart(),n=`
.counter {
  margin: 32px auto;
  display: flex;
  width: 100%;
  max-width: 190px;
  color: #1c6bd1;
}

.btn {
  width: 42px;
  font-size: 32px;
  font-weight: bold;
  background-color: #1c6bd1;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  line-height: 1.4;
}

.btn:hover {
  opacity: 0.8;
}

.count {
  flex: 1;
  font-size: 42px;
  text-align: center;
}
`.trimStart();return{component:r,styles:n}}async function no(e,t){let n=(await j(e,null,!1,!1,null,null,!1)).components.find(o=>o.filePath===t);n&&await j(e,n.id,!0,!1,null,null,!0)}async function nt(e){let t=[];return await e.exists(e.registryPath)||(await e.writeFile(e.registryPath,ro(e)),t.push({filePath:e.registryPath,modifiedType:"create"})),t}function ro(e){return e.typescriptEnabled?`import type { RegisteredComponent } from "@builder.io/react";
    
export const CUSTOM_COMPONENTS: RegisteredComponent[] = [
];`:`export const CUSTOM_COMPONENTS = [
  ];
  `}async function rn(e){let t=await oo(e);return{builderPageOptions:async()=>({templateContentId:"3de2f13211234071a4b19a17b4fbc5a7",pathname:"/builder-demo",title:"Builder Demo Page"}),ensureBuilderSetup:()=>nn(t),getFrameworks:()=>e.frameworks||[],getRegistryPath:()=>t.registryPath,getRegistry:()=>j(t,null,!1,!1,null,null,!1),loadComponent:async n=>{let o=await j(t,n.cmpId,!1,!1,null,null,!1);return{...o,component:o.components.find(i=>i.id===n.cmpId)}},registerComponent:n=>j(t,n.cmpId,!0,!1,null,null,!0),setRegisteredComponentInfo:n=>j(t,n.cmpId,!1,!1,n,null,!0),setRegisteredComponentInput:n=>j(t,n.cmpId,!1,!1,null,n,!0),unregisterComponent:n=>j(t,n.cmpId,!1,!0,null,null,!0),getPublicApiKey:()=>Ze(t),setPublicApiKey:n=>Zt(t,n.publicApiKey),getDependencies:()=>[{name:"@builder.io/dev-tools"},{name:"@builder.io/react"},{name:"@builder.io/sdk"}],getDevRunCommand:()=>"dev"}}async function oo(e){let t=await ao(e),r=await so(e),n=e.dirname(r),o=e.join(n,"components"),i=await io(e),a=`builder-registry.${i?"ts":"js"}`,s=e.join(n,a);return{...e,registryPath:s,remixConfigPath:t,typescriptEnabled:i,appDir:n,componentsDir:o,routesDir:r}}function io(e){let t=e.join(e.getRootDir(),"tsconfig.json");return e.exists(t)}async function ao(e){let t=["remix.config.ts","remix.config.js"];for(let r of t){let n=e.join(e.getRootDir(),r);if(await e.exists(n))return n}throw new Error(`Could not find Remix config file. Searched for ${t.join(", ")} in "${e.getRootDir()}".`)}async function so(e){let t=await le(e,e.getRootDir(),"routes");if(t)return t;throw new Error(`Could not find "routes" directory in "${e.getRootDir()}".`)}var je=$n(Sn(),1);async function hn(e,t){let n={components:(await t.getRegistry()).components.filter(i=>i.isRegistered).map(i=>{let a={filePath:U(e.relative(e.getRootDir(),i.filePath)),name:i.name,image:i.image,description:i.description,exportName:i.exportName,inputs:k(i.inputs)};return k(a)}),version:1};e.debug("exporting registry components:",n.components.length);let o=(0,je.compress)(n);return btoa(JSON.stringify(o))}async function Cn(e,t,r){if(typeof r!="string")throw new Error("Invalid registry to import");let n=await t.getRegistry(),o=JSON.parse(atob(r)),i=(0,je.decompress)(o),a=k(n);e.debug("importing registry components:",i.components.length);for(let s of i.components){let c=U(e.normalize(s.filePath)),u=n.components.find(f=>U(f.filePath).endsWith(c)&&f.exportName===s.exportName);if(!u){console.error(`Could not find component to register: ${s.filePath}, ${s.exportName}`);continue}e.debug(`register (${u.id})`,u.filePath),await t.registerComponent({cmpId:u.id});for(let f of s.inputs)e.debug(`set input (${u.id})`),await t.setRegisteredComponentInput({cmpId:u.id,name:f.name,type:f.type,required:f.required,defaultValue:f.defaultValue,friendlyName:f.friendlyName,helperText:f.helperText});e.debug(`set input (${u.id}) info`);let d=await t.setRegisteredComponentInfo({cmpId:u.id,name:s.name,image:s.image,description:s.description});a=k(d)}return a}var Lo={"@builder.io/qwik-city":Xt,next:Mt,"@remix-run/react":rn};async function ko(e){if(!e.ts)throw new Error("createDevTools() requires a TypeScript instance passed to the 'ts' option");if((!e.frameworks||e.frameworks.length===0)&&(e.frameworks=await ce(e)),e.frameworks.length===0)throw new Error(`Supported Devtools framework for not found within ${e.getRootDir()}`);for(let t of e.frameworks){let r=Lo[t.name];if(r){let n=await r(e);return{...n,exportRegistry:()=>hn(e,n),importRegistry:i=>Cn(e,n,i)}}}throw new Error(`Devtools framework not found for ${e.getRootDir()}, ${JSON.stringify(e.frameworks,null,2)}`)}function wn(e){function t(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function r(f,p){let l="",m=0,x=-1,S=0,g;for(let h=0;h<=f.length;++h){if(h<f.length)g=f.charCodeAt(h);else{if(g===47)break;g=47}if(g===47){if(!(x===h-1||S===1))if(x!==h-1&&S===2){if(l.length<2||m!==2||l.charCodeAt(l.length-1)!==46||l.charCodeAt(l.length-2)!==46){if(l.length>2){let C=l.lastIndexOf("/");if(C!==l.length-1){C===-1?(l="",m=0):(l=l.slice(0,C),m=l.length-1-l.lastIndexOf("/")),x=h,S=0;continue}}else if(l.length===2||l.length===1){l="",m=0,x=h,S=0;continue}}p&&(l.length>0?l+="/..":l="..",m=2)}else l.length>0?l+="/"+f.slice(x+1,h):l=f.slice(x+1,h),m=h-x-1;x=h,S=0}else g===46&&S!==-1?++S:S=-1}return l}let n=function(...p){let l="",m=!1;for(let x=p.length-1;x>=-1&&!m;x--){let S;x>=0?S=p[x]:e.cwd?S=e.cwd():S="/",t(S),S.length!==0&&(l=S+"/"+l,m=S.charCodeAt(0)===47)}return l=r(l,!m),m?l.length>0?"/"+l:"/":l.length>0?l:"."},o=function(p){if(t(p),p.length===0)return".";let l=p.charCodeAt(0)===47,m=p.charCodeAt(p.length-1)===47;return p=r(p,!l),p.length===0&&!l&&(p="."),p.length>0&&m&&(p+="/"),l?"/"+p:p};return{relative:function(p,l){if(t(p),t(l),p===l||(p=n(p),l=n(l),p===l))return"";let m=1;for(;m<p.length&&p.charCodeAt(m)===47;++m);let x=p.length,S=x-m,g=1;for(;g<l.length&&l.charCodeAt(g)===47;++g);let C=l.length-g,w=S<C?S:C,v=-1,y=0;for(;y<=w;++y){if(y===w){if(C>w){if(l.charCodeAt(g+y)===47)return l.slice(g+y+1);if(y===0)return l.slice(g+y)}else S>w&&(p.charCodeAt(m+y)===47?v=y:y===0&&(v=0));break}let N=p.charCodeAt(m+y),kn=l.charCodeAt(g+y);if(N!==kn)break;N===47&&(v=y)}let T="";for(y=m+v+1;y<=x;++y)(y===x||p.charCodeAt(y)===47)&&(T.length===0?T+="..":T+="/..");return T.length>0?T+l.slice(g+v):(g+=v,l.charCodeAt(g)===47&&++g,l.slice(g))},resolve:n,join:function(...p){if(p.length===0)return".";let l;for(let m=0;m<p.length;++m){let x=p[m];t(x),x.length>0&&(l===void 0?l=x:l+="/"+x)}return l===void 0?".":o(l)},isAbsolute:function(p){return t(p),p.length>0&&p.charCodeAt(0)===47},basename:function(p,l){if(l!==void 0&&typeof l!="string")throw new TypeError('"ext" argument must be a string');t(p);let m=0,x=-1,S=!0,g;if(l!==void 0&&l.length>0&&l.length<=p.length){if(l.length===p.length&&l===p)return"";let h=l.length-1,C=-1;for(g=p.length-1;g>=0;--g){let w=p.charCodeAt(g);if(w===47){if(!S){m=g+1;break}}else C===-1&&(S=!1,C=g+1),h>=0&&(w===l.charCodeAt(h)?--h===-1&&(x=g):(h=-1,x=C))}return m===x?x=C:x===-1&&(x=p.length),p.slice(m,x)}else{for(g=p.length-1;g>=0;--g)if(p.charCodeAt(g)===47){if(!S){m=g+1;break}}else x===-1&&(S=!1,x=g+1);return x===-1?"":p.slice(m,x)}},normalize:o,dirname:function(p){if(t(p),p.length===0)return".";let l=p.charCodeAt(0),m=l===47,x=-1,S=!0;for(let g=p.length-1;g>=1;--g)if(l=p.charCodeAt(g),l===47){if(!S){x=g;break}}else S=!1;return x===-1?m?"/":".":m&&x===1?"//":p.slice(0,x)},extname:function(p){t(p);let l=-1,m=0,x=-1,S=!0,g=0;for(let h=p.length-1;h>=0;--h){let C=p.charCodeAt(h);if(C===47){if(!S){m=h+1;break}continue}x===-1&&(S=!1,x=h+1),C===46?l===-1?l=h:g!==1&&(g=1):l!==-1&&(g=-1)}return l===-1||x===-1||g===0||g===1&&l===x-1&&l===m+1?"":p.slice(l,x)}}}async function Ao(e){let t=e.getRootDir?e.getRootDir:()=>"/",r=e.cwd?e.cwd:()=>"/",n=wn({cwd:r,...e}),o=new Map,i=l=>n.normalize(n.resolve(r(),l)),a=l=>{for(let[m]of o)if((m+"/").startsWith(l))return!0;return l===t()},s=l=>(l=i(l),o.has(l)?!0:a(l)),c=l=>{l=i(l);let m=l===t()?l:l+"/",x=m.split("/").length-1,S=[];for(let[g]of o)if(g.split("/").slice(0,x).join("/")+"/"===m){let w=g.split("/")[x];w&&!S.includes(w)&&S.push(w)}return S.sort()},u=l=>{l=i(l);let m=o.get(l);return typeof m=="string"?m:null},d=l=>(l=i(l),{isFile:()=>o.has(l),isDirectory:()=>!o.has(l)&&a(l)}),f=async l=>{if(typeof crypto<"u"){let S=new TextEncoder().encode(l),g=await crypto.subtle.digest("SHA-256",S);return Array.from(new Uint8Array(g)).map(h=>h.toString(16).padStart(2,"0")).join("")}let m=0;for(let x=0;x<l.length;x++){let S=l.charCodeAt(x);m=(m<<5)-m+S,m|=0}return Number(Math.abs(m)).toString(36)},p=new Set;return{getRootDir:t,cwd:r,exists:async l=>s(l),existsSync:s,readdir:async l=>c(l),readdirSync:c,readFile:async l=>u(l),readFileSync:u,stat:async l=>d(l),statSync:d,writeFile:async(l,m)=>{l=i(l),o.set(l,m);let x={path:l,basename:n.basename(l),dirname:n.dirname(l),extname:n.extname(l)};for(let S of p)await S(x)},hash:f,getDeviceId:async()=>typeof navigator<"u"?f(navigator.userAgent):"",formatCode:async(l,m)=>m,on:(l,m)=>{l==="change"&&p.add(m)},off:(l,m)=>{l==="change"&&p.delete(m)},debug:(...l)=>{console.debug("[builder-dev-tools]",...l)},launchEditor:async()=>{},platform:()=>({runtime:"",os:""}),...n,...e}}async function yn(e,t,r){let n=E(e,r),o={content:r,filePath:t,fileName:e.basename(t),hasContentUpdates:!1};if(En(e,n))return o;let a=O(e,n,"cjs");if(a.length!==1)throw new Error(`Expected an export from ${t}`);let s=a[0];if(!s.isDefaultExport)throw new Error(`Expected a default export from ${t}`);if(e.ts.isObjectLiteralExpression(s.node)||e.ts.isCallExpression(s.node)){let u=s.statement;if(!e.ts.isExpressionStatement(u))throw new Error("Expected an expression statement for the default export");let d=u.expression;if(!e.ts.isBinaryExpression(d))throw new Error("Expected a binary expression for the default export");let f=xt(e,n);n=f.sourceFile;let p=[...n.statements],l=p.indexOf(u);return p[l]=e.ts.factory.updateExpressionStatement(u,e.ts.factory.updateBinaryExpression(d,d.left,d.operatorToken,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier(f.withFnVariableName),void 0,[d.right]))),n=e.ts.factory.updateSourceFile(n,p),o.content=P(e,n),o.hasContentUpdates=!0,o}let c=s.statement;if(e.ts.isVariableStatement(c)){let u=[...c.declarationList.declarations];if(u.length!==1)throw new Error("Expected a single variable declaration");let d=u[0];if(!d.initializer)throw new Error("Expected an initializer on the declaration");let f=d.initializer;if(e.ts.isObjectLiteralExpression(f)||e.ts.isCallExpression(f)){let p=xt(e,n);n=p.sourceFile;let l=[...n.statements],m=l.indexOf(c);return l[m]=e.ts.factory.updateVariableStatement(c,c.modifiers,e.ts.factory.updateVariableDeclarationList(c.declarationList,[e.ts.factory.updateVariableDeclaration(d,d.name,d.exclamationToken,d.type,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier(p.withFnVariableName),void 0,[f]))])),n=e.ts.factory.updateSourceFile(n,l),o.content=P(e,n),o.hasContentUpdates=!0,o}throw new Error("Unexpected initializer on the variable statement")}if(e.ts.isArrowFunction(s.node)){let u=s.node,d=s.statement;if(!e.ts.isExpressionStatement(d))throw new Error("Expected an expression statement for the default export");let f=d.expression;if(!e.ts.isBinaryExpression(f))throw new Error("Expected a binary expression for the default export");let l=s.node.body;if(!e.ts.isBlock(l))throw new Error("Expected a block body on the next config function");let m=[...l.statements],x=m.findIndex(w=>e.ts.isReturnStatement(w));if(x===-1)throw new Error("Expected a return statement on the next config function");let S=m[x],g=xt(e,n);n=g.sourceFile,m[x]=e.ts.factory.updateReturnStatement(S,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier(g.withFnVariableName),void 0,[S.expression]));let h=[...n.statements],C=h.indexOf(d);return h[C]=e.ts.factory.updateExpressionStatement(d,e.ts.factory.updateBinaryExpression(f,f.left,f.operatorToken,e.ts.factory.updateArrowFunction(u,u.modifiers,u.typeParameters,u.parameters,u.type,u.equalsGreaterThanToken,e.ts.factory.updateBlock(l,m)))),n=e.ts.factory.updateSourceFile(n,h),o.content=P(e,n),o.hasContentUpdates=!0,o}throw new Error("Unexpected export type")}function En(e,t){for(let r of t.statements)if(e.ts.isVariableStatement(r))for(let n of r.declarationList.declarations){if(!n.initializer||!e.ts.isCallExpression(n.initializer))continue;let o=n.initializer.expression;if(!e.ts.isCallExpression(o)||!e.ts.isIdentifier(o.expression)||o.expression.text!=="require")continue;let i=o.arguments[0];if(!(!i||!e.ts.isStringLiteral(i))&&i.text==="@builder.io/dev-tools/next"&&e.ts.isIdentifier(n.name))return n.name.text}return null}function xt(e,t){let r=En(e,t);return r||(r="withBuilderDevTools",t=e.ts.factory.updateSourceFile(t,[e.ts.factory.createVariableStatement(void 0,e.ts.factory.createVariableDeclarationList([e.ts.factory.createVariableDeclaration(r,void 0,void 0,e.ts.factory.createCallExpression(e.ts.factory.createCallExpression(e.ts.factory.createIdentifier("require"),void 0,[e.ts.factory.createStringLiteral("@builder.io/dev-tools/next")]),void 0,[]))],e.ts.NodeFlags.Const)),...t.statements])),{withFnVariableName:r,sourceFile:t}}async function vn(e,t,r){let n=E(e,r),o={content:r,filePath:t,fileName:e.basename(t),hasContentUpdates:!1};if(Tn(e,n))return o;let a=O(e,n,"cjs");if(a.length!==1)throw new Error(`Expected an export from ${t}`);let s=a[0];if(!s.isDefaultExport)throw new Error(`Expected a default export from ${t}`);if(e.ts.isObjectLiteralExpression(s.node)||e.ts.isCallExpression(s.node)){let u=s.statement;if(!e.ts.isExpressionStatement(u))throw new Error("Expected an expression statement for the default export");let d=u.expression;if(!e.ts.isBinaryExpression(d))throw new Error("Expected a binary expression for the default export");let f=Dn(e,n);n=f.sourceFile;let p=[...n.statements],l=p.indexOf(u);return p[l]=e.ts.factory.updateExpressionStatement(u,e.ts.factory.updateBinaryExpression(d,d.left,d.operatorToken,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier(f.withFnVariableName),void 0,[d.right]))),n=e.ts.factory.updateSourceFile(n,p),o.content=P(e,n),o.hasContentUpdates=!0,o}let c=s.statement;if(e.ts.isVariableStatement(c)){let u=[...c.declarationList.declarations];if(u.length!==1)throw new Error("Expected a single variable declaration");let d=u[0];if(!d.initializer)throw new Error("Expected an initializer on the declaration");let f=d.initializer;if(e.ts.isObjectLiteralExpression(f)||e.ts.isCallExpression(f)){let p=Dn(e,n);n=p.sourceFile;let l=[...n.statements],m=l.indexOf(c);return l[m]=e.ts.factory.updateVariableStatement(c,c.modifiers,e.ts.factory.updateVariableDeclarationList(c.declarationList,[e.ts.factory.updateVariableDeclaration(d,d.name,d.exclamationToken,d.type,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier(p.withFnVariableName),void 0,[f]))])),n=e.ts.factory.updateSourceFile(n,l),o.content=P(e,n),o.hasContentUpdates=!0,o}throw new Error("Unexpected initializer on the variable statement")}throw new Error("Unexpected export type")}function Tn(e,t){for(let r of t.statements)if(e.ts.isVariableStatement(r))for(let n of r.declarationList.declarations){if(!n.initializer||!e.ts.isCallExpression(n.initializer))continue;let o=n.initializer.expression;if(!e.ts.isCallExpression(o)||!e.ts.isIdentifier(o.expression)||o.expression.text!=="require")continue;let i=o.arguments[0];if(!(!i||!e.ts.isStringLiteral(i))&&i.text==="@builder.io/dev-tools/remix"&&e.ts.isIdentifier(n.name))return n.name.text}return null}function Dn(e,t){let r=Tn(e,t);return r||(r="withBuilderDevTools",t=e.ts.factory.updateSourceFile(t,[e.ts.factory.createVariableStatement(void 0,e.ts.factory.createVariableDeclarationList([e.ts.factory.createVariableDeclaration(r,void 0,void 0,e.ts.factory.createCallExpression(e.ts.factory.createCallExpression(e.ts.factory.createIdentifier("require"),void 0,[e.ts.factory.createStringLiteral("@builder.io/dev-tools/remix")]),void 0,[]))],e.ts.NodeFlags.Const)),...t.statements])),{withFnVariableName:r,sourceFile:t}}async function Pn(e,t,r){let n=E(e,r),o=O(e,n);if(o.length!==1)throw new Error(`Expected an export from ${t}`);let i=o[0];if(!i.isDefaultExport)throw new Error(`Expected a default export from ${t}`);let a=i.statement;if(!e.ts.isExportAssignment(a))throw new Error(`Expected an export assignment from ${t}`);let s={content:r,filePath:t,fileName:e.basename(t),hasContentUpdates:!1};if(e.ts.isCallExpression(i.node)&&e.ts.isIdentifier(i.node.expression)&&i.node.expression.text==="defineConfig"){let c=[...i.node.arguments];if(c.length===0)throw new Error("Expected an argument in defineConfig()");let u=c[0];if(e.ts.isArrowFunction(u)){let d=Oo(e,u);if(!d)return s;c[0]=e.ts.factory.updateArrowFunction(u,u.modifiers,u.typeParameters,u.parameters,u.type,u.equalsGreaterThanToken,d);let f=[...n.statements],p=f.indexOf(a);return f[p]=e.ts.factory.updateExportAssignment(a,void 0,e.ts.factory.updateCallExpression(i.node,i.node.expression,i.node.typeArguments,c)),n=e.ts.factory.updateSourceFile(n,f),n=I(e,n,{namedImports:["builderDevTools"],importPath:"@builder.io/dev-tools/vite"}),s.content=P(e,n),s.hasContentUpdates=!0,s}if(e.ts.isObjectLiteralExpression(u)){let d=St(e,u);if(!d)return s;let f=[...n.statements],p=f.indexOf(a);return f[p]=e.ts.factory.updateExportAssignment(a,void 0,e.ts.factory.updateCallExpression(i.node,i.node.expression,i.node.typeArguments,[d])),n=e.ts.factory.updateSourceFile(n,f),n=I(e,n,{namedImports:["builderDevTools"],importPath:"@builder.io/dev-tools/vite"}),s.content=P(e,n),s.hasContentUpdates=!0,s}throw new Error("Unsupported argument in defineConfig()")}if(e.ts.isObjectLiteralExpression(a.expression)){let c=St(e,a.expression);if(!c)return s;let u=[...n.statements],d=u.indexOf(a);return u[d]=e.ts.factory.updateExportAssignment(a,a.modifiers,c),n=e.ts.factory.updateSourceFile(n,u),n=I(e,n,{namedImports:["builderDevTools"],importPath:"@builder.io/dev-tools/vite"}),s.content=P(e,n),s.hasContentUpdates=!0,s}throw new Error(`Unable to parse ${t}`)}function Oo(e,t){let r=t.body;if(!e.ts.isBlock(r))return null;let n=[...r.statements],o=n.findIndex(s=>e.ts.isReturnStatement(s));if(o===-1){let s=e.ts.factory.createReturnStatement(e.ts.factory.createObjectLiteralExpression());n.push(s),o=n.length-1}let i=n[o];if(!i.expression||!e.ts.isObjectLiteralExpression(i.expression))return null;let a=St(e,i.expression);return a?(n[o]=e.ts.factory.updateReturnStatement(i,a),e.ts.factory.updateBlock(r,n)):null}function St(e,t){let r=[...t.properties],n=r.findIndex(i=>D(e,i)==="plugins");if(n>-1){let i=r[n];if(e.ts.isPropertyAssignment(i)&&i.initializer&&e.ts.isArrayLiteralExpression(i.initializer)){let a=bn(e,i.initializer);if(a)return r[n]=e.ts.factory.updatePropertyAssignment(i,i.name,a),e.ts.factory.updateObjectLiteralExpression(t,r)}return null}let o=bn(e,e.ts.factory.createArrayLiteralExpression([],!0));return o?e.ts.factory.updateObjectLiteralExpression(t,[...r,e.ts.factory.createPropertyAssignment("plugins",o)]):null}function bn(e,t){return t.elements.some(n=>e.ts.isCallExpression(n)&&e.ts.isIdentifier(n.expression)?n.expression.text==="builderDevTools":!1)?null:e.ts.factory.updateArrayLiteralExpression(t,[...t.elements,e.ts.factory.createCallExpression(e.ts.factory.createIdentifier("builderDevTools"),void 0,[])])}async function In(e,t,r){throw new Error("Webpack config updates not implemented")}var Rn=[{id:"next",configFileNames:["next.config.ts","next.config.js"],ensureConfigPlugin:yn},{id:"remix",configFileNames:["remix.config.ts","remix.config.js"],ensureConfigPlugin:vn},{id:"vite",configFileNames:["vite.config.ts","vite.config.js"],ensureConfigPlugin:Pn},{id:"webpack",configFileNames:["webpack.config.ts","webpack.config.js"],ensureConfigPlugin:In}];async function Fn(e){let t=e.resolve("/");for(let n of Rn)for(let o of n.configFileNames){let i=e.cwd();for(let a=0;a<10;a++){let s=e.join(i,o),c=e.readFileSync(s);if(typeof c=="string")return{id:n.id,filePath:s,content:c};if(i===t)break;i=e.dirname(i)}}if((await ce(e)).some(n=>n.name==="next")){let n=e.join(e.getRootDir(),"next.config.js");return await e.writeFile(n,Nn),{id:"next",filePath:n,content:Nn}}return null}async function _o(e){let t=await Fn(e);if(!t)throw new Error("Unable to find config file, such as next.config.js or vite.config.js.");let n=await Rn.find(o=>o.id===t.id).ensureConfigPlugin(e,t.filePath,t.content);return n.hasContentUpdates&&(n.content=J(n.content),n.content=await e.formatCode(n.filePath,n.content),await e.writeFile(t.filePath,n.content)),n}var Nn=`
/** @type {import('next').NextConfig} */
const nextConfig = {
}
 
module.exports = nextConfig
`.trimStart();var Ln="/~builder-dev-tools.js";function jo(e){try{if(typeof e!="string"||e.trim().length===0)return console.error("Missing devtool server url"),"";let t=new URL(Ln,e);t.searchParams.set("v",Be);let r=JSON.stringify(Be),n=`/* Builder Devtools v${Be} */
`;return n+=`(() => {
`,n+=`  if (typeof document !== "undefined") {
`,n+=`    let devToolsScript = document.head.querySelector("script[data-builder-dev-tools]");
`,n+=`    if (!devToolsScript) {
`,n+=`      devToolsScript = document.createElement("script");
`,n+=`      devToolsScript.setAttribute("src", ${JSON.stringify(t)});
`,n+=`      devToolsScript.setAttribute("data-builder-dev-tools", ${r});
`,n+=`      devToolsScript.setAttribute("async", "");
`,n+=`      document.head.appendChild(devToolsScript);
`,n+=`    }
`,n+=`  }
`,n+=`})();
`,n}catch(t){return console.error(`Failed to create devtools client script: ${t.message||t}`),""}}var Be="0.1.9";export{ko as createDevTools,Ao as createDevToolsSys,ce as detectFrameworks,yt as detectFrameworksFromPackageJson,_o as ensureConfigPlugin,Fn as findBuildToolConfig,jo as getClientScript,Et as parseDotEnvContent,Be as version};
