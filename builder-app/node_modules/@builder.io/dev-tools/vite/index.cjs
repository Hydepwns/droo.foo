"use strict";var p=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var h=(o,e)=>{for(var t in e)p(o,t,{get:e[t],enumerable:!0})},E=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of T(e))!b.call(o,s)&&s!==t&&p(o,s,{get:()=>e[s],enumerable:!(n=$(e,s))||n.enumerable});return o};var y=o=>E(p({},"__esModule",{value:!0}),o);var I={};h(I,{builderDevTools:()=>V});module.exports=y(I);var u=require("../core/index.cjs"),f=require("../node/index.cjs"),d=require("../server/index.cjs");async function g(o,e){let t=await o.readFile(e);return typeof t=="string"?x(t):null}function x(o){let e={},t=o.replace(/\r\n?/gm,`
`),n;for(;(n=D.exec(t))!=null;){let s=n[1],r=n[2]||"";r=r.trim();let c=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),c==='"'&&(r=r.replace(/\\n/g,`
`),r=r.replace(/\\r/g,"\r")),e[s]=r}return e}var D=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function V(o={}){return{name:"vite-plugin-builder-dev-tools",async configureServer(t){let n=await(0,f.createDevToolsNodeSys)({getRootDir:()=>t.config.root}),s=await(0,u.createDevTools)(n),r=await(0,d.createDevToolsServer)({...s,getClientId:()=>"vite-builder-dev-tools",closeAppServer:async()=>{n.debug("close server"),await t?.close()},restartAppServer:async()=>{n.debug("restart server"),await t?.restart()},enableAppWatch:async c=>{if(c){n.debug("enable watch"),t?.watcher.add(t.config.root);let i=n.join(t.config.root,".git"),l=n.join(t.config.root,"node_modules");t?.watcher.unwatch([i,l])}else n.debug("disable watch"),t?.watcher.unwatch(t.config.root);return c},...n,...o});t.watcher.on("change",async c=>{if(c.includes(".env")){let i=await g(n,c);i&&Object.keys(i).forEach(a=>{process.env[a]=i[a]})}}),t.middlewares.use(async(c,i,l)=>{try{let a=i.end;i.end=function(...w){if((i.getHeader("Content-Type")||"").toString().includes("text/html")){let m=(0,u.getClientScript)(r.getUrl());i.write(`<script>${m}</script>`)}return a.apply(this,w)},l()}catch(a){l(a)}})}}}0&&(module.exports={builderDevTools});
