"use strict";var d=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var w=(r,e)=>{for(var o in e)d(r,o,{get:e[o],enumerable:!0})},D=(r,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of m(e))!y.call(r,a)&&a!==o&&d(r,a,{get:()=>e[a],enumerable:!(t=b(e,a))||t.enumerable});return r};var S=r=>D(d({},"__esModule",{value:!0}),r);var P={};w(P,{default:()=>E});module.exports=S(P);var f=require("../core/index.cjs"),h=require("../node/index.cjs"),p=require("../server/index.cjs"),n=require("path"),s=require("fs"),E=(r={})=>e=>{if(r.enabled==null&&(r.enabled=process.env.NODE_ENV!=="production"),r.enabled===!1)return e;let o={...e},t=R(process.cwd()),a=(0,n.dirname)(t);process.env.BUILDER_REMIX_DEVTOOLS_URL="http://localhost:5273/",o.watchPaths=async()=>{let l=await(0,h.createDevToolsNodeSys)({getRootDir:()=>a}),c=await(0,f.createDevTools)(l),i=await(0,p.createDevToolsServer)({...c,getClientId:()=>"remix-builder-dev-tools",closeAppServer:async()=>{},restartAppServer:async()=>{l.debug("restart server");let v=(0,s.readFileSync)(t,"utf-8");(0,s.writeFileSync)(t,v)},enableAppWatch:async v=>v,...l,...r});return process.env.BUILDER_REMIX_DEVTOOLS_URL=i.getUrl(),typeof e.watchPaths=="function"?e.watchPaths():e.watchPaths?e.watchPaths:[]};let u=(0,n.join)(__dirname,"server-build","index.mjs");if(!(0,s.existsSync)(u))return console.log(`Builder Devtools unable to run: "${u}" not found`),e;if(typeof e.server=="string"){let l=(0,n.resolve)((0,n.dirname)(t),e.server);if(!(0,s.existsSync)(l))return console.log(`Builder Devtools unable to run: "${l}" set from "${e.server}" server config not found`),e;let c=!1,i=(0,s.readFileSync)(l,"utf-8");for(;i.includes("@remix-run/dev/server-build");)i=i.replace("@remix-run/dev/server-build","@builder.io/dev-tools/remix/server-build"),c=!0;c&&(0,s.writeFileSync)(l,i)}else o.server=u;return o};function R(r){let e=(0,n.resolve)("/");for(let o=0;o<20;o++){let t=(0,n.join)(r,"remix.config.js");if((0,s.existsSync)(t)||(t=(0,n.join)(r,"remix.config.ts"),(0,s.existsSync)(t)))return t;if(r===e)break;r=(0,n.dirname)(r)}throw new Error("Could not find Remix config")}
